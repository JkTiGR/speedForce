<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f1a" />
  <title>CYBER DRAGON ‚Äî Menu</title>
  <link rel="icon" href="logo.png"/>
  <style>
    html { scroll-behavior: smooth; }
    :root{
      --bg:#0b0f1a; --text:#fff; --muted:#9fb3c8;
      --glass:rgba(255,255,255,.06); --glass-strong:rgba(16,22,36,.72);
      --line:rgba(255,255,255,.12);
      --brandA:#4fd3ff; --brandB:#8f00ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--text);
      font:16px/1.48 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      background: url('fon.png') center/cover fixed no-repeat, var(--bg);
      -webkit-tap-highlight-color:transparent;
    }
    body::after{content:"";position:fixed;inset:0;pointer-events:none;z-index:-1;
      background:
        radial-gradient(1100px 900px at 10% -10%, #4168ff22, transparent 60%),
        radial-gradient(1100px 900px at 90% 110%, #b34dff22, transparent 55%);
    }

    .app{max-width:430px;margin:0 auto;min-height:100dvh;
      padding:calc(14px + env(safe-area-inset-top)) 14px calc(28px + env(safe-area-inset-bottom));}

    /* Header */
    .header{position:sticky; top:0; z-index:30; margin:-6px -4px 8px}
    .bar{
      display:flex;align-items:center;gap:10px;padding:8px;border-radius:16px;
      background:linear-gradient(to bottom, rgba(10,15,26,.85), rgba(10,15,26,.5));
      border:1px solid var(--line); backdrop-filter:saturate(140%) blur(12px);
    }
    .brand{margin:0;font-size:1.06rem;letter-spacing:.35px;display:flex;align-items:center;gap:6px;font-weight:900}
    .brand .mark{height:18px;filter:drop-shadow(0 0 6px #9b5bff94)}
    .lang{margin-left:auto}
    .lang select{
      appearance:none;border-radius:10px;padding:10px 28px 10px 12px;min-height:44px;
      color:var(--text);background:var(--glass-strong);border:1px solid var(--line);outline:none
    }
    .burger{
      width:44px;height:44px;border-radius:12px;border:1px solid var(--line);
      background:var(--glass-strong);color:#fff;display:grid;place-items:center;cursor:pointer
    }
    .nav-pop{
      position:absolute;right:14px;top:64px;background:rgba(10,14,24,.94);backdrop-filter:blur(14px) saturate(140%);
      border:1px solid var(--line);border-radius:14px;padding:8px;display:none;min-width:220px;z-index:40
    }
    .nav-pop.open{display:block}
    .nav-pop a,.nav-pop .lang-inline{
      display:flex;align-items:center;gap:10px;padding:12px;border-radius:10px;color:#fff;text-decoration:none;min-height:44px
    }
    .nav-pop a:hover,.nav-pop .lang-inline:hover{background:var(--glass)}
    .nav-pop hr{border:0;height:1px;background:var(--line);margin:6px 0}
    .nav-pop .lang-inline select{flex:1;background:var(--glass-strong);border:1px solid var(--line);color:#fff;border-radius:10px;padding:8px 10px;min-height:44px}

    /* Category pills */
    .cat-nav {
      display: flex;
      align-items: center;
      gap: 10px;
      position: sticky;
      top: 0;
      z-index: 20;
      background: var(--bg);
      margin: 0 -14px;
      padding: 0 14px;
    }
    .h-scroll{display:flex;gap:8px;overflow:auto;scroll-snap-type:x proximity;padding:6px 0; flex: 1;}
    .pill{
      scroll-snap-align:start;white-space:nowrap;padding:10px 14px;border-radius:999px;border:1px solid var(--line);
      background:var(--glass);backdrop-filter:blur(8px);color:#fff;cursor:pointer;min-height:44px;text-decoration: none;
    }
    .pill:active{transform:scale(.98)}
    .pill.active{background:linear-gradient(90deg,var(--brandA),var(--brandB));color:#001027;border:none;font-weight:800}

    /* Head (title + view toggle) */
    .head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:8px}
    .head h3{margin:0}
    .view-toggle{
      width:40px;height:40px;border-radius:12px;border:1px solid var(--line);
      background:var(--glass-strong);color:#fff;display:grid;place-items:center;cursor:pointer
    }
    .view-toggle:active{transform:scale(.98)}
    .view-toggle svg{width:22px;height:22px;display:none}
    .view-toggle[data-view="grid"] .ico-list{display:block}
    .view-toggle[data-view="list"] .ico-grid{display:block}

    /* GRID */
    .list{display:grid;gap:10px;margin-top:8px;grid-template-columns:repeat(2,minmax(0,1fr))}
    .card{
      display:grid;grid-template-rows:auto auto auto;gap:8px;
      padding:10px;border-radius:18px;background:var(--glass);border:1px solid var(--line);backdrop-filter:blur(10px);
      position:relative;overflow:hidden
    }
    .thumb-wrap{position:relative}
    .thumb{width:100%;aspect-ratio:1/1;border-radius:20px;overflow:hidden;background:linear-gradient(135deg,#3a517f,#7a45cc)}
    .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;border-radius:inherit}
    @supports (clip-path: inset(0 round 20px)){ .thumb{clip-path: inset(0 round 20px);} }
    .info{
      position:absolute;right:8px;top:8px;width:28px;height:28px;border-radius:999px;border:1px solid var(--line);
      background:var(--glass-strong);color:#fff;cursor:pointer;display:grid;place-items:center;font-weight:800
    }
    .name{font-weight:800;line-height:1.2;min-height:2.4em}
    .desc{display:none;color:var(--muted);font-size:.92rem}
    .card.expanded .desc{display:block}
    .foot{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .price{font-weight:800}
    .add{
      border:none;border-radius:999px;padding:10px 14px;background:linear-gradient(90deg,var(--brandA),var(--brandB));
      color:#001027;font-weight:800;cursor:pointer;min-height:40px;flex:1
    }

    /* LIST view */
    .list.as-list{grid-template-columns:1fr}
    .list.as-list .card{grid-template-columns:92px 1fr auto;grid-template-rows:auto auto;gap:10px}
    .list.as-list .thumb{width:92px;height:92px;aspect-ratio:auto;border-radius:14px}
    .list.as-list .thumb-wrap{grid-row:1/3}
    .list.as-list .name{grid-column:2}
    .list.as-list .foot{grid-column:2/4;justify-content:space-between}

    .qty{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);border-radius:999px;padding:6px 8px}
    .qty button{width:32px;height:32px;border:none;border-radius:10px;background:var(--glass-strong);color:#fff;cursor:pointer}

    /* FAB cart */
    .fab{position:sticky;bottom:calc(14px + env(safe-area-inset-bottom));display:flex;justify-content:center;margin-top:14px;z-index:35}
    .cart-fab{
      display:inline-flex;align-items:center;gap:10px;border:none;border-radius:999px;padding:12px 18px;cursor:pointer;color:#001027;
      background:linear-gradient(90deg,var(--brandA),var(--brandB));font-weight:800;box-shadow:0 18px 28px #001a2f66;min-height:48px
    }

    /* Sheet */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);opacity:0;pointer-events:none;transition:.2s opacity;z-index:40}
    .overlay.show{opacity:1;pointer-events:auto}
    .sheet{
      position:fixed;left:0;right:0;bottom:0;width:100%;max-width:430px;margin:0 auto;
      background:rgba(10,14,24,.96);backdrop-filter:blur(16px) saturate(140%);
      border-top-left-radius:18px;border-top-right-radius:18px;border:1px solid var(--line);
      padding:14px;padding-bottom:calc(14px + env(safe-area-inset-bottom));
      transition:.25s transform; transform:translateY(100%);
      z-index:41; max-height:85dvh; overflow:auto; overscroll-behavior:contain;
    }
    .sheet.open{ transform:translateY(0) }
    .sheet h3{margin:0 0 8px}
    .cart-lines{display:grid;gap:10px;max-height:38dvh;overflow:auto;padding-right:4px}
    .line{display:grid;grid-template-columns:1fr auto;align-items:center;gap:10px;padding:8px;border-radius:12px;border:1px dashed var(--line)}
    .section{margin-top:10px}
    .group{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:10px 14px;border-radius:999px;background:var(--glass);border:1px solid var(--line);cursor:pointer;min-height:44px}
    .chip.active{background:linear-gradient(90deg,var(--brandA),var(--brandB));color:#001027;border:none;font-weight:800}
    .field{display:grid;gap:6px;margin-top:8px}
    .field input,.field textarea,.field select{
      border-radius:10px;padding:12px;background:var(--glass-strong);color:#fff;border:1px solid var(--line);outline:none;font-size:1rem;min-height:44px
    }
    .field textarea{min-height:72px;resize:vertical}
    .checkout{display:grid;gap:8px;margin-top:10px}
    .btn{border:none;border-radius:14px;padding:12px 14px;font-weight:800;cursor:pointer;min-height:48px}
    .btn.primary{background:linear-gradient(90deg,var(--brandA),var(--brandB));color:#001027}
    .btn.ghost{background:transparent;border:1px dashed var(--line);color:#fff}
    .muted{color:var(--muted)}

    /* === Glassmorphism buttons ‚Äî override === */
    :root{ --glass-btn: rgba(255,255,255,.08); --glass-btn-2: rgba(255,255,255,.12); --ring: rgba(255,255,255,.20); }
    .btn,.add,.cart-fab,.app-badge,.chip,.pill,.qty button,.burger,.view-toggle{
      background: var(--glass-btn); color: var(--text); border: 1px solid var(--line);
      border-radius: 14px; box-shadow: inset 0 1px 0 #ffffff10, inset 0 -1px 0 #00000030, 0 10px 24px #00000040;
      backdrop-filter: blur(12px) saturate(140%); -webkit-backdrop-filter: blur(12px) saturate(140%); text-decoration: none;
    }
    .btn,.add{ min-height: 44px; padding: 12px 16px; font-weight: 800; border-radius: 999px; }
    .cart-fab{ min-height:48px; padding:12px 18px; border-radius:999px; }
    .chip,.pill{ min-height:40px; padding:10px 14px; border-radius:999px; }
    .qty button{ width:32px; height:32px; border-radius:10px; }
    .burger{ width:44px; height:44px; border-radius:12px; }
    .btn:hover,.add:hover,.cart-fab:hover,.app-badge:hover,.chip:hover,.pill:hover,.qty button:hover,.burger:hover,.view-toggle:hover{
      background: var(--glass-btn-2); border-color: var(--ring);
      box-shadow: inset 0 1px 0 #ffffff18, inset 0 -1px 0 #00000040, 0 12px 28px #00000055, 0 0 0 1px var(--ring);
    }
    .btn:active,.add:active,.cart-fab:active,.app-badge:active,.chip:active,.pill:active,.qty button:active,.burger:active,.view-toggle:active{
      transform: translateY(1px) scale(.99); box-shadow: inset 0 2px 8px #00000060, 0 6px 16px #00000055;
    }
    .btn.primary{ background: var(--glass-btn); color: var(--text); border: 1px solid var(--line); }

    /* Logo block on top */
    .center{display:grid;place-items:center;gap:12px;margin:10px 0 6px}
    .logoBig{width:min(220px,60%);aspect-ratio:1/1;object-fit:contain;filter:drop-shadow(0 0 22px #a975ff80)}



  </style>
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="bar">
        <h1 class="brand">CYBER <img class="mark" src="logo.png" alt="Logo"> DRAGON</h1>
        <div class="lang"><select id="langSel" aria-label="Language">
          <option value="ru">RU</option><option value="en">EN</option>
          <option value="ua">UA</option><option value="vn">VN</option>
          <option value="pl">PL</option><option value="de">DE</option>
          <option value="zh">ZH</option></select>
        </div>
        <button class="burger" id="burgerBtn" aria-haspopup="true" aria-expanded="false" aria-controls="navPop">‚ò∞</button>
        <nav class="nav-pop" id="navPop" role="menu" aria-label="Main menu">
          <a href="index.html" id="navHome" role="menuitem">üè† HOME</a>
          <a href="#" id="navMenu" role="menuitem">üçú MENU</a>
          <a href="#" id="navKaraoke" role="menuitem">üé§ KARAOKE</a>
          <a href="#" id="navContact" role="menuitem">üìû KONTAKT</a>
          <hr>
          <div class="lang-inline" role="none">üåê
            <select id="langSelMenu" aria-label="Language (menu)">
              <option value="ru">RU</option><option value="en">EN</option>
              <option value="ua">UA</option><option value="vn">VN</option>
              <option value="pl">PL</option><option value="de">DE</option>
              <option value="zh">ZH</option>
            </select>
          </div>
        </nav>
      </div>
    </header>

    <!-- Hero logo + CTA -->
    <div class="center" role="banner">
      <img class="logoBig" src="logo.png" alt="Cyber Dragon">
      <a class="btn" href="#catPills" id="btnMenu">üçú –ú–µ–Ω—é</a>
    </div>


    <!-- Category pills -->
    <nav class="cat-nav">
      <div class="h-scroll" id="catPills" aria-label="Categories"></div>
      <button class="view-toggle" id="viewToggle" data-view="grid" aria-label="–í–∏–¥ —Å–ø–∏—Å–∫–æ–º" title="–í–∏–¥ —Å–ø–∏—Å–∫–æ–º">
        <!-- icon list -->
        <svg class="ico-list" viewBox="0 0 24 24" fill="none">
          <rect x="4" y="6"  width="16" height="2" rx="1" fill="white"/>
          <rect x="4" y="11" width="16" height="2" rx="1" fill="white"/>
          <rect x="4" y="16" width="16" height="2" rx="1" fill="white"/>
        </svg>
        <!-- icon grid -->
        <svg class="ico-grid" viewBox="0 0 24 24" fill="none">
          <rect x="4"  y="4"  width="7" height="7" rx="1" stroke="white" stroke-width="1.6"/>
          <rect x="13" y="4"  width="7" height="7" rx="1" stroke="white" stroke-width="1.6"/>
          <rect x="4"  y="13" width="7" height="7" rx="1" stroke="white" stroke-width="1.6"/>
          <rect x="13" y="13" width="7" height="7" rx="1" stroke="white" stroke-width="1.6"/>
        </svg>
      </button>
    </nav>
    <main id="content"></main>

    <!-- FAB Cart -->
    <div class="fab">
      <button class="cart-fab" id="cartFab" aria-haspopup="dialog">üõí <span id="fabText">0 —à—Ç. ‚Ä¢ 0.00 z≈Ç</span></button>
    </div>
  </div>

  <!-- Bottom Sheet -->
  <div class="overlay" id="overlay"></div>
  <div class="sheet" id="sheet" role="dialog" aria-modal="true" aria-labelledby="sheetTitle">
    <h3 id="sheetTitle">–í–∞—à –∑–∞–∫–∞–∑</h3>
    <div class="cart-lines" id="cartLines"><div class="muted">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</div></div>

    <div class="section">
      <div class="muted" id="orderTypeTitle" style="margin-bottom:6px">–¢–∏–ø –∑–∞–∫–∞–∑–∞</div>
      <div class="group" id="orderType">
        <button class="chip active" data-ot="on_site" id="otOnSite">–ù–∞ –º–µ—Å—Ç–µ</button>
        <button class="chip" data-ot="takeaway" id="otTakeaway">–ù–∞ –≤—ã–Ω–æ—Å</button>
        <button class="chip" data-ot="delivery" id="otDelivery">–î–æ—Å—Ç–∞–≤–∫–∞</button>
      </div>

      <div class="field" id="tableField" style="display:grid">
        <label for="tableNo" id="tableLbl">–°—Ç–æ–ª <span class="muted" id="tableHint">(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
        <input id="tableNo" type="number" min="1" inputmode="numeric" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 5">
      </div>

      <div class="field" id="takeawayField" style="display:none">
        <label for="pickupIn" id="pickupLbl">–ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –∑–∞–±—Ä–∞—Ç—å (–º–∏–Ω) <span class="muted" id="pickupHint">(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
        <input id="pickupIn" type="number" min="5" step="5" placeholder="15">
      </div>

      <div class="field" id="addrField" style="display:none">
        <label for="address" id="addrLbl">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ <span class="muted" id="addrHint">(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
        <textarea id="address" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –ø–æ–¥—ä–µ–∑–¥..."></textarea>
      </div>

      <div class="field" id="phoneField">
        <label for="phone" id="phoneLbl">–¢–µ–ª–µ—Ñ–æ–Ω <span class="muted" id="phoneHint">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
        <input id="phone" type="tel" placeholder="+48 600 000 000">
      </div>
    </div>

    <div class="checkout">
      <div class="muted" id="cartMeta">–ò—Ç–æ–≥–æ: 0.00 z≈Ç</div>
      <button class="btn primary" id="checkoutBtn">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
      <button class="btn ghost" id="clearBtn">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>

  <!-- DATA -->
  <script src="menu.js"></script>

  <script>
  /* ==== LANG & I18N ==== */
  const LANG_KEY='CD_LANG';
  let LANG = localStorage.getItem(LANG_KEY) || 'ru';
  document.documentElement.lang = LANG;

  // –ù–∞–≤–±–∞—Ä + UI + —à—Ç–æ—Ä–∫–∞ –∑–∞–∫–∞–∑–∞ (7 —è–∑—ã–∫–æ–≤)
  const I18N = {
    ru:{navHome:'–ì–ª–∞–≤–Ω–∞—è',navMenu:'–ú–µ–Ω—é',navKaraoke:'–ö–∞—Ä–∞–æ–∫–µ',navContact:'–ö–æ–Ω—Ç–∞–∫—Ç—ã',
        ui:{add:'–î–æ–±–∞–≤–∏—Ç—å',more:'–ü–æ–¥—Ä–æ–±–Ω–µ–µ',itemsShort:'—à—Ç.',viewList:'–í–∏–¥ —Å–ø–∏—Å–∫–æ–º',viewGrid:'–í–∏–¥ —Å–µ—Ç–∫–æ–π'},
        sheet:{title:'–í–∞—à –∑–∞–∫–∞–∑',empty:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.',orderType:'–¢–∏–ø –∑–∞–∫–∞–∑–∞',
               onSite:'–ù–∞ –º–µ—Å—Ç–µ',takeaway:'–ù–∞ –≤—ã–Ω–æ—Å',delivery:'–î–æ—Å—Ç–∞–≤–∫–∞',
               table:'–°—Ç–æ–ª',pickupIn:'–ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –∑–∞–±—Ä–∞—Ç—å (–º–∏–Ω)',address:'–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',phone:'–¢–µ–ª–µ—Ñ–æ–Ω',
               phTable:'–ù–∞–ø—Ä–∏–º–µ—Ä, 5',phPickup:'15',phAddress:'–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –ø–æ–¥—ä–µ–∑–¥...',phPhone:'+48 600 000 000',
               total:'–ò—Ç–æ–≥–æ',checkout:'–û—Ñ–æ—Ä–º–∏—Ç—å',clear:'–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É',
               errTable:'–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —Å—Ç–æ–ª–∞.',errPickup:'–£–∫–∞–∂–∏—Ç–µ —á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –∑–∞–±—Ä–∞—Ç—å.',
               errPhone:'–£–∫–∞–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω.',errAddress:'–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏.'},
        common:{required:'(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)',optional:'(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)'}},
    en:{navHome:'Home',navMenu:'Menu',navKaraoke:'Karaoke',navContact:'Contact',
        ui:{add:'Add',more:'More',itemsShort:'pcs',viewList:'List view',viewGrid:'Grid view'},
        sheet:{title:'Your order',empty:'Cart is empty.',orderType:'Order type',
               onSite:'Dine-in',takeaway:'Takeaway',delivery:'Delivery',
               table:'Table',pickupIn:'Pickup in (min)',address:'Delivery address',phone:'Phone',
               phTable:'e.g., 5',phPickup:'15',phAddress:'City, street, house‚Ä¶',phPhone:'+48 600 000 000',
               total:'Total',checkout:'Checkout',clear:'Clear cart',
               errTable:'Please enter table number.',errPickup:'Please enter pickup time (min).',
               errPhone:'Please enter phone.',errAddress:'Please enter delivery address.'},
        common:{required:'(required)',optional:'(optional)'}},
    ua:{navHome:'–ì–æ–ª–æ–≤–Ω–∞',navMenu:'–ú–µ–Ω—é',navKaraoke:'–ö–∞—Ä–∞–æ–∫–µ',navContact:'–ö–æ–Ω—Ç–∞–∫—Ç–∏',
        ui:{add:'–î–æ–¥–∞—Ç–∏',more:'–î–æ–∫–ª–∞–¥–Ω—ñ—à–µ',itemsShort:'—à—Ç.',viewList:'–í–∏–≥–ª—è–¥ —Å–ø–∏—Å–∫–æ–º',viewGrid:'–í–∏–≥–ª—è–¥ —Å—ñ—Ç–∫–æ—é'},
        sheet:{title:'–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è',empty:'–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π.',orderType:'–¢–∏–ø –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è',
               onSite:'–£ –∑–∞–∫–ª–∞–¥—ñ',takeaway:'–ù–∞ –≤–∏–Ω—ñ—Å',delivery:'–î–æ—Å—Ç–∞–≤–∫–∞',
               table:'–°—Ç—ñ–ª',pickupIn:'–ß–µ—Ä–µ–∑ —Å–∫—ñ–ª—å–∫–∏ –∑–∞–±—Ä–∞—Ç–∏ (—Ö–≤)',address:'–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏',phone:'–¢–µ–ª–µ—Ñ–æ–Ω',
               phTable:'–ù–∞–ø—Ä–∏–∫–ª–∞–¥, 5',phPickup:'15',phAddress:'–ú—ñ—Å—Ç–æ, –≤—É–ª–∏—Ü—è, –±—É–¥–∏–Ω–æ–∫‚Ä¶',phPhone:'+48 600 000 000',
               total:'–†–∞–∑–æ–º',checkout:'–û—Ñ–æ—Ä–º–∏—Ç–∏',clear:'–û—á–∏—Å—Ç–∏—Ç–∏ –∫–æ—à–∏–∫',
               errTable:'–í–∫–∞–∂—ñ—Ç—å –Ω–æ–º–µ—Ä —Å—Ç–æ–ª—É.',errPickup:'–í–∫–∞–∂—ñ—Ç—å —á–∞—Å –æ—Ç—Ä–∏–º–∞–Ω–Ω—è (—Ö–≤).',
               errPhone:'–í–∫–∞–∂—ñ—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω.',errAddress:'–í–∫–∞–∂—ñ—Ç—å –∞–¥—Ä–µ—Å—É –¥–æ—Å—Ç–∞–≤–∫–∏.'},
        common:{required:'(–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)',optional:'(–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)'}},
    pl:{navHome:'Start',navMenu:'Menu',navKaraoke:'Karaoke',navContact:'Kontakt',
        ui:{add:'Dodaj',more:'Szczeg√≥≈Çy',itemsShort:'szt.',viewList:'Widok listy',viewGrid:'Widok siatki'},
        sheet:{title:'Twoje zam√≥wienie',empty:'Koszyk jest pusty.',orderType:'Rodzaj zam√≥wienia',
               onSite:'Na miejscu',takeaway:'Na wynos',delivery:'Dostawa',
               table:'St√≥≈Ç',pickupIn:'Odbi√≥r za (min)',address:'Adres dostawy',phone:'Telefon',
               phTable:'Np. 5',phPickup:'15',phAddress:'Miasto, ulica, nr domu‚Ä¶',phPhone:'+48 600 000 000',
               total:'Suma',checkout:'Zam√≥w',clear:'Wyczy≈õƒá koszyk',
               errTable:'Podaj numer sto≈Çu.',errPickup:'Podaj czas odbioru (min).',
               errPhone:'Podaj telefon.',errAddress:'Podaj adres dostawy.'},
        common:{required:'(wymagane)',optional:'(opcjonalnie)'}},
    de:{navHome:'Start',navMenu:'Men√º',navKaraoke:'Karaoke',navContact:'Kontakt',
        ui:{add:'Hinzuf√ºgen',more:'Details',itemsShort:'St.',viewList:'Listenansicht',viewGrid:'Rasteransicht'},
        sheet:{title:'Ihre Bestellung',empty:'Warenkorb ist leer.',orderType:'Bestellart',
               onSite:'Vor Ort',takeaway:'Zum Mitnehmen',delivery:'Lieferung',
               table:'Tisch',pickupIn:'Abholung in (Min.)',address:'Lieferadresse',phone:'Telefon',
               phTable:'z. B. 5',phPickup:'15',phAddress:'Stadt, Stra√üe, Nr.‚Ä¶',phPhone:'+48 600 000 000',
               total:'Gesamt',checkout:'Bestellen',clear:'Warenkorb leeren',
               errTable:'Bitte Tisch-Nr. eingeben.',errPickup:'Bitte Abholzeit (Min.) eingeben.',
               errPhone:'Bitte Telefon eingeben.',errAddress:'Bitte Lieferadresse eingeben.'},
        common:{required:'(erforderlich)',optional:'(optional)'}},
    zh:{navHome:'‰∏ªÈ°µ',navMenu:'ËèúÂçï',navKaraoke:'Âç°ÊãâOK',navContact:'ËÅîÁ≥ª',
        ui:{add:'Ê∑ªÂä†',more:'ËØ¶ÊÉÖ',itemsShort:'‰ª∂',viewList:'ÂàóË°®ËßÜÂõæ',viewGrid:'ÁΩëÊ†ºËßÜÂõæ'},
        sheet:{title:'ÊÇ®ÁöÑËÆ¢Âçï',empty:'Ë¥≠Áâ©ËΩ¶‰∏∫Á©∫„ÄÇ',orderType:'ËÆ¢ÂçïÁ±ªÂûã',
               onSite:'Â†ÇÈ£ü',takeaway:'Â§ñÂ∏¶',delivery:'ÈÖçÈÄÅ',
               table:'Ê°åÂè∑',pickupIn:'ÂèñÈ§êÊó∂Èó¥ÔºàÂàÜÈíüÔºâ',address:'ÈÖçÈÄÅÂú∞ÂùÄ',phone:'ÁîµËØù',
               phTable:'‰æãÂ¶Ç 5',phPickup:'15',phAddress:'ÂüéÂ∏Ç„ÄÅË°óÈÅì„ÄÅÈó®Áâå‚Ä¶',phPhone:'+48 600 000 000',
               total:'ÂêàËÆ°',checkout:'‰∏ãÂçï',clear:'Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶',
               errTable:'ËØ∑ËæìÂÖ•Ê°åÂè∑„ÄÇ',errPickup:'ËØ∑ËæìÂÖ•ÂèñÈ§êÊó∂Èó¥ÔºàÂàÜÈíüÔºâ„ÄÇ',
               errPhone:'ËØ∑ËæìÂÖ•ÁîµËØù„ÄÇ',errAddress:'ËØ∑ËæìÂÖ•ÈÖçÈÄÅÂú∞ÂùÄ„ÄÇ'},
        common:{required:'(ÂøÖÂ°´)',optional:'(ÂèØÈÄâ)'}},
    vn:{navHome:' Trang ch·ªß',navMenu:'Th·ª±c ƒë∆°n',navKaraoke:'Karaoke',navContact:'Li√™n h·ªá',
        ui:{add:'Th√™m',more:'Chi ti·∫øt',itemsShort:'m√≥n',viewList:'D·∫°ng danh s√°ch',viewGrid:'D·∫°ng l∆∞·ªõi'},
        sheet:{title:'ƒê∆°n h√†ng c·ªßa b·∫°n',empty:'Gi·ªè h√†ng tr·ªëng.',orderType:'H√¨nh th·ª©c ƒë·∫∑t',
               onSite:'ƒÇn t·∫°i ch·ªó',takeaway:'Mang ƒëi',delivery:'Giao h√†ng',
               table:'B√†n',pickupIn:'Nh·∫≠n sau (ph√∫t)',address:'ƒê·ªãa ch·ªâ giao h√†ng',phone:'ƒêi·ªán tho·∫°i',
               phTable:'V√≠ d·ª•: 5',phPickup:'15',phAddress:'Th√†nh ph·ªë, ƒë∆∞·ªùng, s·ªë nh√†‚Ä¶',phPhone:'+48 600 000 000',
               total:'T·ªïng c·ªông',checkout:'ƒê·∫∑t h√†ng',clear:'X√≥a gi·ªè h√†ng',
               errTable:'Vui l√≤ng nh·∫≠p s·ªë b√†n.',errPickup:'Vui l√≤ng nh·∫≠p th·ªùi gian nh·∫≠n (ph√∫t).',
               errPhone:'Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i.',errAddress:'Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng.'},
        common:{required:'(b·∫Øt bu·ªôc)',optional:'(kh√¥ng b·∫Øt bu·ªôc)'}}
  };
  const L = ()=>I18N[LANG]||I18N.en;

  // ==== Descriptions loader ====
  // Lazy-load descriptions from descriptions.json. If not yet loaded, fetch the file and cache it.
  let DESCS = null;
  async function loadDescriptions(){
    if(DESCS) return DESCS;
    try{
      const resp = await fetch('descriptions.json');
      if(resp.ok){ DESCS = await resp.json(); return DESCS; }
    }catch(e){ console.error('Failed to load descriptions.json', e); }
    DESCS = {};
    return DESCS;
  }

  /* ==== CATEGORIES (labels) ==== */
  const CAT_LABELS={
    'wyroznione':{ru:'–í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ',en:'Featured',ua:'–í–∏–¥—ñ–ª–µ–Ω—ñ',pl:'Wyr√≥≈ºnione',de:'Hervorgehoben',zh:'Á≤æÈÄâ',vn:'N·ªïi b·∫≠t'},
    'zupy':{ru:'–°—É–ø—ã',en:'Soups',ua:'–°—É–ø–∏',pl:'Zupy',de:'Suppen',zh:'Ê±§ÂìÅ',vn:'S√∫p'},
    'przekaski':{ru:'–ó–∞–∫—É—Å–∫–∏',en:'Appetizers',ua:'–ó–∞–∫—É—Å–∫–∏',pl:'PrzekƒÖski',de:'Vorspeisen',zh:'ÂºÄËÉÉËèú',vn:'M√≥n khai v·ªã'},
    'dania_z_kurczakiem':{ru:'–ë–ª—é–¥–∞ —Å –∫—É—Ä–∏—Ü–µ–π',en:'Chicken Dishes',ua:'–°—Ç—Ä–∞–≤–∏ –∑ –∫—É—Ä–∫–∏',pl:'Dania z kurczakiem',de:'Gerichte mit Huhn',zh:'È∏°ËÇâËèúËÇ¥',vn:'M√≥n g√†'},
    'dania_z_wieprzowina':{ru:'–ë–ª—é–¥–∞ —Å–æ —Å–≤–∏–Ω–∏–Ω–æ–π',en:'Pork Dishes',ua:'–°—Ç—Ä–∞–≤–∏ –∑—ñ —Å–≤–∏–Ω–∏–Ω–∏',pl:'Dania z wieprzowinƒÖ',de:'Gerichte mit Schweinefleisch',zh:'Áå™ËÇâËèúËÇ¥',vn:'M√≥n heo'},
    'dania_z_wolowina':{ru:'–ë–ª—é–¥–∞ —Å –≥–æ–≤—è–¥–∏–Ω–æ–π',en:'Beef Dishes',ua:'–°—Ç—Ä–∞–≤–∏ –∑ —è–ª–æ–≤–∏—á–∏–Ω–∏',pl:'Dania z wo≈ÇowinƒÖ',de:'Gerichte mit Rindfleisch',zh:'ÁâõËÇâËèúËÇ¥',vn:'M√≥n b√≤'},
    'makaron_chinski_smazony':{ru:'–ñ–∞—Ä–µ–Ω–∞—è –∫–∏—Ç–∞–π—Å–∫–∞—è –ª–∞–ø—à–∞',en:'Fried Chinese Noodles',ua:'–°–º–∞–∂–µ–Ω–∞ –∫–∏—Ç–∞–π—Å—å–∫–∞ –ª–æ–∫—à–∏–Ω–∞',pl:'Makaron chi≈Ñski sma≈ºony',de:'Gebratene chinesische Nudeln',zh:'ÁÇí‰∏≠ÂºèÈù¢Êù°',vn:'M√¨ Trung Qu·ªëc x√†o'},
    'makaron_sojowy_smazony':{ru:'–ñ–∞—Ä–µ–Ω–∞—è —Å–æ–µ–≤–∞—è –ª–∞–ø—à–∞',en:'Fried Soy Noodles',ua:'–°–º–∞–∂–µ–Ω–∞ —Å–æ—î–≤–∞ –ª–æ–∫—à–∏–Ω–∞',pl:'Makaron sojowy sma≈ºony',de:'Gebratene Sojanudeln',zh:'ÁÇíË±ÜÈù¢Êù°',vn:'M√¨ ƒë·∫≠u n√†nh x√†o'},
    'makaron_udon':{ru:'–õ–∞–ø—à–∞ —É–¥–æ–Ω',en:'Udon Noodles',ua:'–õ–æ–∫—à–∏–Ω–∞ —É–¥–æ–Ω',pl:'Makaron udon',de:'Udon-Nudeln',zh:'‰πåÂÜ¨Èù¢',vn:'M√¨ udon'},
    'pad_thai':{ru:'–ü–∞–¥ –¢–∞–π',en:'Pad Thai',ua:'–ü–∞–¥ –¢–∞–π',pl:'Pad Thai',de:'Pad Thai',zh:'Ê≥∞ÂºèÁÇíÊ≤≥Á≤â',vn:'Pad Thai'},
    'ryz_smazony':{ru:'–ñ–∞—Ä–µ–Ω—ã–π —Ä–∏—Å',en:'Fried Rice',ua:'–°–º–∞–∂–µ–Ω–∏–π —Ä–∏—Å',pl:'Ry≈º sma≈ºony',de:'Gebratener Reis',zh:'ÁÇíÈ•≠',vn:'C∆°m chi√™n'},
    'dania_z_kaczka':{ru:'–ë–ª—é–¥–∞ —Å —É—Ç–∫–æ–π',en:'Duck Dishes',ua:'–°—Ç—Ä–∞–≤–∏ –∑ –∫–∞—á–∫–∏',pl:'Dania z kaczkƒÖ',de:'Gerichte mit Ente',zh:'È∏≠ËÇâËèúËÇ¥',vn:'M√≥n v·ªãt'},
    'dania_z_ryba_i_owocami_morza':{ru:'–ë–ª—é–¥–∞ —Å —Ä—ã–±–æ–π –∏ –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏',en:'Fish and Seafood Dishes',ua:'–°—Ç—Ä–∞–≤–∏ –∑ —Ä–∏–±–∏ —Ç–∞ –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ñ–≤',pl:'Dania z rybƒÖ i owocami morza',de:'Gerichte mit Fisch und Meeresfr√ºchten',zh:'È±ºÂíåÊµ∑È≤úËèúËÇ¥',vn:'M√≥n c√° v√† h·∫£i s·∫£n'},
    'dania_z_golonka':{ru:'–ë–ª—é–¥–∞ —Å –≥–æ–ª—è—à–∫–æ–π',en:'Knuckle Dishes',ua:'–°—Ç—Ä–∞–≤–∏ –∑ –≥–æ–ª—è—à–∫–∏',pl:'Dania z golonkƒÖ',de:'Gerichte mit Haxe',zh:'Áå™ËπÑËèúËÇ¥',vn:'M√≥n gi√≤ heo'},
    'curry':{ru:'–ö–∞—Ä—Ä–∏',en:'Curry',ua:'–ö–∞—Ä—Ä—ñ',pl:'Curry',de:'Curry',zh:'ÂíñÂñ±',vn:'C√† ri'},
    'dania_z_goracego_polmiska':{ru:'–ë–ª—é–¥–∞ —Å –≥–æ—Ä—è—á–µ–π —Ç–∞—Ä–µ–ª–∫–∏',en:'Hot Plate Dishes',ua:'–°—Ç—Ä–∞–≤–∏ –∑ –≥–∞—Ä—è—á–æ—ó —Ç–∞—Ä—ñ–ª–∫–∏',pl:'Dania z gorƒÖcego p√≥≈Çmiska',de:'Gerichte vom hei√üen Teller',zh:'ÁÉ≠ÁõòËèúËÇ¥',vn:'M√≥n ƒëƒ©a n√≥ng'},
    'dania_wegetarianskie':{ru:'–í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∏–µ –±–ª—é–¥–∞',en:'Vegetarian Dishes',ua:'–í–µ–≥–µ—Ç–∞—Ä—ñ–∞–Ω—Å—å–∫—ñ —Å—Ç—Ä–∞–≤–∏',pl:'Dania wegetaria≈Ñskie',de:'Vegetarische Gerichte',zh:'Á¥†È£üËèúËÇ¥',vn:'M√≥n chay'},
    'dodatki':{ru:'–î–æ–±–∞–≤–∫–∏',en:'Sides',ua:'–î–æ–±–∞–≤–∫–∏',pl:'Dodatki',de:'Beilagen',zh:'ÈÖçËèú',vn:'Ph·ª• ki·ªán'},
    'napoje':{ru:'–ù–∞–ø–∏—Ç–∫–∏',en:'Drinks',ua:'–ù–∞–ø–æ—ó',pl:'Napoje',de:'Getr√§nke',zh:'È•ÆÊñô',vn:'ƒê·ªì u·ªëng'}
  };
  const catLabel = k => (CAT_LABELS[k]?.[LANG] || CAT_LABELS[k]?.en || k);
  </script>

  <script>
  /* ==== Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ==== */
  const TG = { BOT_TOKEN:"6819820426:AAEWwwN8tYLVPo6U-g6EjWCo4evnJ2SaGk4", CHAT_ID:-1002156259709, PROXY_URL:"" };
  const TG_ENDPOINT = (b)=> (TG.PROXY_URL || `https://api.telegram.org/bot${b}/sendMessage`);

  /* ==== Helpers ==== */
  const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
  const CURRENCY='z≈Ç';
  const IMG_DIR='images/'; const IMG_EXTS=['webp','jpg','jpeg','png'];
  const fmt=n=>Number(n).toFixed(2)+' '+CURRENCY;

  function buildThumb(imgEl,key){
    let i=0; const trySet=()=>imgEl.src=IMG_DIR+key+'.'+IMG_EXTS[i];
    imgEl.onerror=()=>{ i++; if(i<IMG_EXTS.length){ trySet(); } else { imgEl.closest('.thumb')?.classList.add('noimg'); imgEl.remove(); } };
    trySet();
  }
  const itemName=it=>it?.translations?.[LANG]||it?.translations?.en||it?.key?.replaceAll('_',' ')||'';

  /* ==== State ==== */
  const cart=new Map(); let currentCat=null;

  /* ==== Pills ==== */
  function renderPills(){
    const keys=Object.keys(menuData||{}); 
    const wrap=$('#catPills');
    wrap.innerHTML=keys.map((k,i)=>`<a class="pill ${i===0?'active':''}" href="#sec-${k}">${catLabel(k)}</a>`).join('');
  }

  /* ==== View toggle ==== */
  const VIEW_KEY='CD_VIEW_MENU';
  let viewMode = localStorage.getItem(VIEW_KEY) || 'grid'; // grid | list
  function applyView(){
    const btn=$('#viewToggle');
    $$('.list').forEach(wrap => wrap.classList.toggle('as-list', viewMode==='list'));
    if(btn){
      btn.dataset.view=viewMode;
      const t=L().ui; const label = viewMode==='grid' ? t.viewList : t.viewGrid;
      btn.setAttribute('aria-label', label); btn.title=label;
    }
  }
  $('#viewToggle')?.addEventListener('click', ()=>{
    viewMode = (viewMode==='grid') ? 'list' : 'grid';
    localStorage.setItem(VIEW_KEY, viewMode); applyView();
  });

  /* ==== Render menu ==== */
  function renderMenu(){
    const content = $('#content'); 
    const keys=Object.keys(menuData||{});
    content.innerHTML = '';
    keys.forEach(k => {
      const sec = document.createElement('section');
      sec.id = `sec-${k}`;
      const h2 = document.createElement('h2');
      h2.textContent = catLabel(k);
      sec.appendChild(h2);
      const list = document.createElement('div');
      list.className = 'list';
      const items=(menuData[k]||[]); const t=L();
      list.innerHTML=items.map((it,idx)=>{
        const id = `${k}:${idx}`, name = itemName(it), price = fmt(it.price||0);
        const qty = cart.get(id) || 0;
        const btn = qty
          ? `<div class="qty" data-qty="${id}"><button data-dec="${id}">‚àí</button><span>${qty}</span><button data-inc="${id}">+</button></div>`
          : `<button class="add" data-add="${id}">${t.ui.add}</button>`;
        const more = t.ui.more;
        const key = (it && (it.key || it.id || it.code)) || '';
        const shortDesc = (it && (it.short || it.desc || '')) || '';
        return `
          <div class="card" data-id="${id}"${key ? ` data-key="${key}"` : ''}>
            <div class="thumb-wrap">
              <div class="thumb"><img alt="${name}" loading="lazy" decoding="async"></div>
              <button class="info" data-toggle="${id}" title="${more}" aria-label="${more}" aria-expanded="false" aria-controls="desc-${id}">i</button>
            </div>
            <div class="name">${name}</div>
            <p class="desc" id="desc-${id}" aria-hidden="true">${shortDesc}</p>
            <div class="foot">
              <div class="price">${price}</div>
              ${btn}
            </div>
          </div>`;
      }).join('');
      sec.appendChild(list);
      content.appendChild(sec);

      // images
      list.querySelectorAll('.card').forEach(row=>{
        const id=row.getAttribute('data-id'); const [cat,idx]=id.split(':');
        const key=(menuData?.[cat]?.[+idx]?.key)||''; const img=row.querySelector('.thumb img');
        if(img && key) buildThumb(img,key);
      });
    });
    applyView();
  }

  /* ==== Cart renders ==== */
  function renderFab(){
    const t=L().ui; let items=0,sum=0;
    for(const [id,qty] of cart){ const [cat,idx]=id.split(':'); const it=menuData[cat]?.[+idx]; if(!it) continue; items+=qty; sum+=(it.price||0)*qty; }
    $('#fabText').textContent=`${items} ${t.itemsShort} ‚Ä¢ ${fmt(sum)}`;
  }
  function renderCartSheet(){
    const t=L().sheet; const lines=$('#cartLines');
    if(cart.size===0){ lines.innerHTML=`<div class="muted">${t.empty}</div>`; $('#cartMeta').textContent=`${t.total}: ${fmt(0)}`; return; }
    let sum=0; lines.innerHTML='';
    for(const [id,qty] of cart){
      const [cat,idx]=id.split(':'); const it=menuData[cat]?.[+idx]; if(!it) continue;
      const name=itemName(it); const price=Number(it.price||0); sum+=price*qty;
      const el=document.createElement('div'); el.className='line';
      el.innerHTML=`<div><strong>${name}</strong><div class="muted">${fmt(price)} √ó ${qty}</div></div>
        <div class="qty" data-qty="${id}"><button data-dec="${id}">‚àí</button><span>${qty}</span><button data-inc="${id}">+</button></div>`;
      lines.appendChild(el);
    }
    $('#cartMeta').textContent=`${t.total}: ${fmt(sum)}`;
  }

  function openSheet(){ document.body.style.overflow='hidden'; $('#overlay').classList.add('show'); $('#sheet').classList.add('open'); renderCartSheet(); }
  function closeSheet(){ document.body.style.overflow=''; $('#overlay').classList.remove('show'); $('#sheet').classList.remove('open'); }

  /* ==== Events ==== */
document.addEventListener('click', async e=>{
    const add=e.target.closest('[data-add]'); if(add){const id=add.dataset.add; cart.set(id,(cart.get(id)||0)+1); renderMenu(); renderFab(); return;}
    const inc=e.target.closest('[data-inc]'); if(inc){const id=inc.dataset.inc; cart.set(id,(cart.get(id)||0)+1); renderMenu(); renderCartSheet(); renderFab(); return;}
    const dec=e.target.closest('[data-dec]'); if(dec){const id=dec.dataset.dec; const q=(cart.get(id)||0)-1; if(q<=0) cart.delete(id); else cart.set(id,q); renderMenu(); renderCartSheet(); renderFab(); return;}
    const info=e.target.closest('[data-toggle]');
    if(info){
      e.preventDefault();
      const cardId = info.dataset.toggle;
      const card   = document.querySelector(`.card[data-id="${cardId}"]`);
      if(card){
        const expanded = card.classList.contains('expanded');
        if(!expanded){
          const descEl = card.querySelector('.desc');
          if(descEl){
            let text = '';
            // determine key from card or menuData
            let key = card.getAttribute('data-key');
            if(!key){
              const parts0 = cardId.split(':');
              if(parts0.length === 2){
                const [cat0, idx0] = parts0;
                const it0 = (menuData?.[cat0] || [])[+idx0];
                key = (it0 && (it0.key || it0.id || it0.code)) || '';
              }
            }
            if(key){
              try{
                const descs = await loadDescriptions();
                const entry = descs[key];
                if(entry && entry.description){
                  text = entry.description[LANG] || entry.description.en || '';
                }
              }catch(err){ console.error(err); }
            }
            // fallback to any existing description on item
            if(!text){
              const parts1 = cardId.split(':');
              if(parts1.length === 2){
                const [cat1, idx1] = parts1;
                const it1 = (menuData?.[cat1] || [])[+idx1];
                const fallback = (it1 && (it1.desc || it1.short || '')) || '';
                text = fallback;
              }
            }
            if(text) descEl.textContent = text;
          }
        }
        card.classList.toggle('expanded');
        info.setAttribute('aria-expanded', (!expanded).toString());
        const descEl2 = card.querySelector('.desc');
        if(descEl2) descEl2.setAttribute('aria-hidden', expanded.toString());
      }
      return;
    }
    if(e.target.closest('#cartFab')){ openSheet(); return; }
    if(e.target.id==='overlay'){ closeSheet(); return; }
    if(e.target.id==='clearBtn'){ cart.clear(); renderMenu(); renderCartSheet(); renderFab(); return; }
  });

  /* ==== Burger ==== */
  const burgerBtn=$('#burgerBtn'), navPop=$('#navPop');
  burgerBtn.addEventListener('click',()=>{const open=navPop.classList.toggle('open'); burgerBtn.setAttribute('aria-expanded',String(open));});
  document.addEventListener('click',e=>{if(!navPop.contains(e.target)&&e.target!==burgerBtn){navPop.classList.remove('open'); burgerBtn.setAttribute('aria-expanded','false');}});

  /* ==== Order type switch ==== */
  const otWrap=$('#orderType'), tableField=$('#tableField'), takeawayField=$('#takeawayField'), addrField=$('#addrField');
  const tableNo=$('#tableNo'), pickupIn=$('#pickupIn'), address=$('#address'), phone=$('#phone');
  const phoneHint=$('#phoneHint'), tableHint=$('#tableHint'), pickupHint=$('#pickupHint'), addrHint=$('#addrHint');

  function show(el,on){ el.style.display=on?'grid':'none'; }
  function setOrderType(v){
    const c=L();
    show(tableField, v==='on_site'); show(takeawayField, v==='takeaway'); show(addrField, v==='delivery');
    tableNo.required=(v==='on_site'); pickupIn.required=(v==='takeaway'); address.required=(v==='delivery');
    phoneHint.textContent = (v==='on_site') ? c.common.optional : c.common.required;
    tableHint.textContent  = c.common.required;
    pickupHint.textContent = c.common.required;
    addrHint.textContent   = c.common.required;
  }
  otWrap.addEventListener('click',e=>{
    const b=e.target.closest('[data-ot]'); if(!b) return;
    $$('#orderType .chip').forEach(x=>x.classList.remove('active')); b.classList.add('active'); setOrderType(b.dataset.ot);
  });

  /* ==== I18N apply ==== */
  function setUITexts(){
    const t=L(), s=t.sheet;

    // navbar
    $('#navHome').textContent  = 'üè† ' + t.navHome;
    $('#navMenu').textContent  = 'üçú ' + t.navMenu;
    $('#navKaraoke').textContent='üé§ ' + t.navKaraoke;
    $('#navContact').textContent='üìû ' + t.navContact;

    // sheet labels
    $('#sheetTitle').textContent     = s.title;
    $('#orderTypeTitle').textContent = s.orderType;
    $('#otOnSite').textContent       = s.onSite;
    $('#otTakeaway').textContent     = s.takeaway;
    $('#otDelivery').textContent     = s.delivery;

    // labels + hints
    $('#tableLbl').childNodes[0].nodeValue  = s.table + ' ';
    $('#pickupLbl').childNodes[0].nodeValue = s.pickupIn + ' ';
    $('#addrLbl').childNodes[0].nodeValue   = s.address + ' ';
    $('#phoneLbl').childNodes[0].nodeValue  = s.phone + ' ';

    // placeholders
    tableNo.placeholder = s.phTable;
    pickupIn.placeholder= s.phPickup;
    address.placeholder = s.phAddress;
    phone.placeholder   = s.phPhone;

    // totals / buttons
    const meta=$('#cartMeta');
    if(meta){ const sum=(meta.textContent.match(/[\d.,]+\s*z≈Ç/)||['0.00 z≈Ç'])[0]; meta.textContent=`${s.total}: ${sum}`; }
    $('#checkoutBtn').textContent = s.checkout;
    $('#clearBtn').textContent    = s.clear;

    // view toggle text
    applyView();

    // re-render pills/list/fab to update text in buttons
    renderPills(); renderMenu(); renderFab(); renderCartSheet();

    // keep current order type requirements up to date
    const active=document.querySelector('#orderType .chip.active')?.dataset.ot||'on_site';
    setOrderType(active);
  }

  /* ==== Language selectors ==== */
  const selA=$('#langSel'), selB=$('#langSelMenu');
  function setLang(v){
    LANG=v; localStorage.setItem(LANG_KEY,v); document.documentElement.lang=v;
    if(selA) selA.value=v; if(selB) selB.value=v; setUITexts();
  }
  selA.addEventListener('change',e=>setLang(e.target.value));
  selB.addEventListener('change',e=>setLang(e.target.value));

  /* ==== Telegram send ==== */
  async function sendOrderToTelegram(text){
    const url = TG_ENDPOINT(TG.BOT_TOKEN);
    const payload = {chat_id: TG.CHAT_ID, text, parse_mode: "HTML", disable_web_page_preview: true};
    try{
      const r = await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      if(r.ok) return {ok:true}; // –µ—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –¥–∞—ë—Ç CORS-ok
      await fetch(url,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      return {ok:true, opaque:true};
    }catch(e){ console.error(e); return {ok:false, reason:String(e)}; }
  }

  function cartSummary(){
    let items=0,sum=0, lines=[];
    for(const [id,qty] of cart){
      const [cat,idx]=id.split(':'); const it=menuData[cat]?.[+idx]; if(!it) continue;
      const name=itemName(it); const price=Number(it.price||0);
      items+=qty; sum+=price*qty; lines.push(`‚Ä¢ ${name} ‚Äî ${price.toFixed(2)} ${CURRENCY} √ó ${qty}`);
    }
    return {items,sum,lines};
  }

  $('#checkoutBtn').addEventListener('click', async ()=>{
    const s=L().sheet;
    const ot=document.querySelector('#orderType .chip.active')?.dataset.ot||'on_site';
    if(ot==='on_site' && !tableNo.value.trim()){ alert(s.errTable); return; }
    if(ot==='takeaway'){
      if(!pickupIn.value.trim()){ alert(s.errPickup); return; }
      if(!phone.value.trim()){ alert(s.errPhone); return; }
    }
    if(ot==='delivery'){
      if(!address.value.trim()){ alert(s.errAddress); return; }
      if(!phone.value.trim()){ alert(s.errPhone); return; }
    }

    const {sum,lines}=cartSummary();
    const typeStr = ot==='on_site'?s.onSite:ot==='takeaway'?s.takeaway:s.delivery;
    const meta=[];
    if(ot==='on_site') meta.push(`${s.table}: ${tableNo.value.trim()}`);
    if(ot==='takeaway') meta.push(`${s.pickupIn}: ${pickupIn.value.trim()}`);
    if(ot==='delivery') meta.push(`${s.address}: ${address.value.trim()}`);
    if(phone.value.trim()) meta.push(`${s.phone}: ${phone.value.trim()}`);
    const ordId='CD-'+new Date().toISOString().replace(/[-:TZ.]/g,'').slice(0,14);

    const text =
`<b>CYBER DRAGON ‚Äî New order</b>
ID: <code>${ordId}</code>
${s.total}: <b>${sum.toFixed(2)} ${CURRENCY}</b>
Type: <b>${typeStr}</b>
${meta.join('\n')}

<b>Items:</b>
${lines.join('\n') || '‚Äî'}`;

    const res = await sendOrderToTelegram(text);
    alert((res.ok?'‚úî':'‚Ä¶') + ' ID: '+ordId+' ‚Ä¢ '+s.total+': '+sum.toFixed(2)+' '+CURRENCY);
    cart.clear(); renderMenu(); renderCartSheet(); renderFab(); closeSheet();
  });

  /* ==== Scroll highlight ==== */
  let activeCat = '';
  const debounce = (fn, delay) => {
    let timer;
    return () => {
      clearTimeout(timer);
      timer = setTimeout(fn, delay);
    }
  };
  function updateActive() {
    const header = $('.header');
    const catNav = $('.cat-nav');
    if (!header || !catNav) return;
    const stickyH = header.offsetHeight + catNav.offsetHeight;
    let maxTop = -Infinity;
    let closest = null;
    $$('section').forEach(sec => {
      const top = sec.getBoundingClientRect().top;
      if (top <= stickyH && top > maxTop) {
        maxTop = top;
        closest = sec;
      }
    });
    if (closest) {
      const cat = closest.id.replace('sec-', '');
      if (cat !== activeCat) {
        activeCat = cat;
        $$('.pill').forEach(p => p.classList.remove('active'));
        const pill = $(`.pill[href="#${closest.id}"]`);
        if (pill) {
          pill.classList.add('active');
          pill.scrollIntoView({behavior: 'smooth', inline: 'center'});
        }
      }
    }
  }
  window.addEventListener('scroll', debounce(updateActive, 50));

  /* ==== Init ==== */
  (function init(){
    // lang selects to current
    if(selA) selA.value=LANG;
    if(selB) selB.value=LANG;
    setUITexts(); // also renders
    const header = $('.header');
    const catNav = $('.cat-nav');
    if (header && catNav) {
      catNav.style.top = `${header.offsetHeight}px`;
    }
    updateActive();
  })();
  </script>

  <!-- –í–∞—à data-—Ñ–∞–π–ª —Å –º–µ–Ω—é -->
  <script src="menu.js"></script>
</body>
</html>