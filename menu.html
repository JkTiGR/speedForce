<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f1a" />
  <title>CYBER DRAGONâ€” Menu</title>
  <link rel="icon" href="logo.png"/>
  <link rel="stylesheet" href="base.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="bar">
        <h1 class="brand" id="brandTap">CYBER <img class="mark" src="logo.png" alt="Logo"> DRAGON</h1>

        <div class="lang"><select id="langSel" aria-label="Language">
          <option value="ru">ğŸ‡ºğŸ‡¦RUğŸ‡ºğŸ‡¦</option><option value="en">EN ğŸ‡¬ğŸ‡§</option>
          <option value="ua">UA ğŸ‡ºğŸ‡¦</option><option value="vn">VN ğŸ‡»ğŸ‡³</option>
          <option value="pl">PL ğŸ‡µğŸ‡±</option><option value="de">DE ğŸ‡©ğŸ‡ª</option>
          <option value="zh">ZH ğŸ‡¨ğŸ‡³</option></select>
        </div>

        <button class="burger" id="burgerBtn" aria-haspopup="true" aria-expanded="false" aria-controls="navPop">â˜°</button>

        <nav class="nav-pop" id="navPop" role="menu" aria-label="Main menu">
          <a href="index.html" id="navHome" role="menuitem">ğŸ  HOME</a>
          <a href="#" id="navMenu" role="menuitem">ğŸœ MENU</a>
          <a href="#" id="navKaraoke" role="menuitem">ğŸ¤ KARAOKE</a>
          <a href="#" id="navContact" role="menuitem">ğŸ“ CONTACT</a>
          <hr>
          <div class="lang-inline" role="none">ğŸŒ
            <select id="langSelMenu" aria-label="Language (menu)">
              <option value="ru">ğŸ‡ºğŸ‡¦RUğŸ‡ºğŸ‡¦</option><option value="en">EN ğŸ‡¬ğŸ‡§</option>
              <option value="ua">UA ğŸ‡ºğŸ‡¦</option><option value="vn">VN ğŸ‡»ğŸ‡³</option>
              <option value="pl">PL ğŸ‡µğŸ‡±</option><option value="de">DE ğŸ‡©ğŸ‡ª</option>
              <option value="zh">ZH ğŸ‡¨ğŸ‡³</option>
            </select>
          </div>
        </nav>
      </div>
    </header>

    <div class="hero">
      <img src="promo.jpg" alt="Promo image" class="promo">
      <button class="dock-btn hero-menu" id="heroAllCats" aria-haspopup="dialog" aria-controls="catSheet" title="ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸">
        MENU
      </button>
      <div class="social">
        <a href="https://www.facebook.com/" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
          <img src="images/icon/fb.png" alt="Facebook">
        </a>

        <a href="https://www.instagram.com/cyber_dragon_ua/" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
          <img src="images/icon/ig.png" alt="Instagram">
        </a>

        <a href="https://www.whatsapp.com/?lang=ru_RU" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
          <img src="images/icon/wa.png" alt="WhatsApp">
        </a>

        <a href="https://www.tiktok.com/" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
          <img src="images/icon/tt.png" alt="TikTok">
        </a>
      </div>
    </div>

    <!-- Category pills -->
    <nav class="cat-nav glass-nav">
      <div class="h-scroll" id="catPills" aria-label="Categories"></div>
    </nav>

    <main id="content"></main>

    <!-- All categories sheet (for Dock) -->
    <div class="overlay" id="catOverlay"></div>
    <div class="sheet" id="catSheet" role="dialog" aria-modal="true" aria-labelledby="catSheetTitle">
      <div class="sheet-handle" aria-hidden="true"></div>
      <button class="sheet-close" id="catSheetClose" aria-label="Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ">âœ•</button>
      <h3 id="catSheetTitle">ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸</h3>
      <div class="group" id="catSheetList"></div>
    </div>

    <!-- Bottom glass Dock -->
    <nav class="dock" aria-label="Dock">
      <!-- MENU â†’ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Â«Ğ’ÑĞµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸Â» -->
      <button class="dock-btn" id="dockCat" aria-label="Ğ’ÑĞµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸" title="ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸">
        <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
          <rect x="4" y="6" width="16" height="2" rx="1"></rect>
          <rect x="4" y="11" width="16" height="2" rx="1"></rect>
          <rect x="4" y="16" width="16" height="2" rx="1"></rect>
        </svg>
      </button>

      <!-- Ğ¯Ğ·Ñ‹ĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»ÑŒ -->
      <div class="dock-lang">
        <select id="langSelDock" aria-label="Language">
          <option value="ru">ğŸ‡ºğŸ‡¦RUğŸ‡ºğŸ‡¦</option><option value="en">EN ğŸ‡¬ğŸ‡§</option>
          <option value="ua">UA ğŸ‡ºğŸ‡¦</option><option value="vn">VN ğŸ‡»ğŸ‡³</option>
          <option value="pl">PL ğŸ‡µğŸ‡±</option><option value="de">DE ğŸ‡©ğŸ‡ª</option>
          <option value="zh">ZH ğŸ‡¨ğŸ‡³</option>
        </select>
      </div>

      <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹ -->
      <button class="cart-fab" id="cartFab" aria-haspopup="dialog">
        ğŸ›’ <span id="fabText">0 szt. â€¢ 0.00 zÅ‚</span>
      </button>

      <button class="dock-btn" id="dockView" aria-label="ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ²Ğ¸Ğ´" title="ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ²Ğ¸Ğ´">
        <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
          <rect x="4" y="4" width="7" height="7" rx="1" stroke-width="1.6" fill="none" stroke="currentColor"></rect>
          <rect x="13" y="4" width="7" height="7" rx="1" stroke-width="1.6" fill="none" stroke="currentColor"></rect>
          <rect x="4" y="13" width="7" height="7" rx="1" stroke-width="1.6" fill="none" stroke="currentColor"></rect>
          <rect x="13" y="13" width="7" height="7" rx="1" stroke-width="1.6" fill="none" stroke="currentColor"></rect>
        </svg>
      </button>
    </nav>

    <!-- Cart Bottom Sheet -->
    <div class="overlay" id="overlay"></div>
    <div class="sheet" id="sheet" role="dialog" aria-modal="true" aria-labelledby="sheetTitle">
      <div class="sheet-handle" aria-hidden="true"></div>
      <button class="sheet-close" id="sheetClose" aria-label="Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ">âœ•</button>
      <h3 id="sheetTitle">Ğ’Ğ°Ñˆ Ğ·Ğ°ĞºĞ°Ğ·</h3>
      <div class="cart-lines" id="cartLines"><div class="muted">ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¿ÑƒÑÑ‚Ğ°.</div></div>

      <div class="section">
        <div class="muted" id="orderTypeTitle" style="margin-bottom:6px">Ğ¢Ğ¸Ğ¿ Ğ·Ğ°ĞºĞ°Ğ·Ğ°</div>
        <div class="group" id="orderType">
          <button class="chip active" data-ot="on_site" id="otOnSite">ĞĞ° Ğ¼ĞµÑÑ‚Ğµ</button>
          <button class="chip" data-ot="takeaway" id="otTakeaway">ĞĞ° Ğ²Ñ‹Ğ½Ğ¾Ñ</button>
          <button class="chip" data-ot="delivery" id="otDelivery">Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°</button>
        </div>

        <div class="field" id="tableField" style="display:grid">
          <label for="tableNo" id="tableLbl">Ğ¡Ñ‚Ğ¾Ğ» <span class="muted" id="tableHint">(Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</span></label>
          <input id="tableNo" type="number" min="1" inputmode="numeric" placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 5">
        </div>

        <div class="field" id="takeawayField" style="display:none">
          <label for="pickupIn" id="pickupLbl">Ğ§ĞµÑ€ĞµĞ· ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ (Ğ¼Ğ¸Ğ½) <span class="muted" id="pickupHint">(Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</span></label>
          <input id="pickupIn" type="number" min="5" step="5" placeholder="15">
        </div>

        <div class="field" id="addrField" style="display:none">
          <label for="address" id="addrLbl">ĞĞ´Ñ€ĞµÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸ <span class="muted" id="addrHint">(Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</span></label>
          <textarea id="address" placeholder="Ğ“Ğ¾Ñ€Ğ¾Ğ´, ÑƒĞ»Ğ¸Ñ†Ğ°, Ğ´Ğ¾Ğ¼, Ğ¿Ğ¾Ğ´ÑŠĞµĞ·Ğ´..."></textarea>
        </div>

        <div class="field" id="phoneField">
          <label for="phone" id="phoneLbl">Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½ <span class="muted" id="phoneHint">(Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</span></label>
          <input id="phone" type="tel" placeholder="+48 600 000 000">
        </div>
      </div>

      <div class="checkout">
        <div class="muted" id="cartMeta">Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 0.00 zÅ‚</div>
        <button class="btn primary" id="checkoutBtn">ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ</button>
        <button class="btn ghost" id="clearBtn">ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ</button>
      </div>
    </div>

    <!-- DATA -->
    <script src="menu.js"></script>

    <script>
    /* ==== LANG & I18N ==== */
    const LANG_KEY='CD_LANG';
    let LANG = localStorage.getItem(LANG_KEY) || 'ru';
    document.documentElement.lang = LANG;

    // === Google Sheets API (Apps Script) ===
    const API_BASE = "https://script.google.com/macros/s/AKfycbwq1zMVIS18h_zwuLvuJpfNm3J1TatH5tQu9cVVkaZx4zXyTMa0i7lvcACaEdXEjAG6/exec";

    const I18N = {
      ru:{navHome:'Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ',navMenu:'ĞœĞµĞ½Ñ',navKaraoke:'ĞšĞ°Ñ€Ğ°Ğ¾ĞºĞµ',navContact:'ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹',
          ui:{add:'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ',more:'ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ĞµĞµ',itemsShort:'ÑˆÑ‚.',viewList:'Ğ’Ğ¸Ğ´ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼',viewGrid:'Ğ’Ğ¸Ğ´ ÑĞµÑ‚ĞºĞ¾Ğ¹'},
          sheet:{title:'Ğ’Ğ°Ñˆ Ğ·Ğ°ĞºĞ°Ğ·',empty:'ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¿ÑƒÑÑ‚Ğ°.',orderType:'Ğ¢Ğ¸Ğ¿ Ğ·Ğ°ĞºĞ°Ğ·Ğ°',
                 onSite:'ĞĞ° Ğ¼ĞµÑÑ‚Ğµ',takeaway:'ĞĞ° Ğ²Ñ‹Ğ½Ğ¾Ñ',delivery:'Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°',
                 table:'Ğ¡Ñ‚Ğ¾Ğ»',pickupIn:'Ğ§ĞµÑ€ĞµĞ· ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ (Ğ¼Ğ¸Ğ½)',address:'ĞĞ´Ñ€ĞµÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸',phone:'Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½',
                 phTable:'ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 5',phPickup:'15',phAddress:'Ğ“Ğ¾Ñ€Ğ¾Ğ´, ÑƒĞ»Ğ¸Ñ†Ğ°, Ğ´Ğ¾Ğ¼, Ğ¿Ğ¾Ğ´ÑŠĞµĞ·Ğ´...',phPhone:'+48 600 000 000',
                 total:'Ğ˜Ñ‚Ğ¾Ğ³Ğ¾',checkout:'ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ',clear:'ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ',
                 errTable:'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ¼ĞµÑ€ ÑÑ‚Ğ¾Ğ»Ğ°.',errPickup:'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ.',
                 errPhone:'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½.',errAddress:'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸.'},
          common:{required:'(Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)',optional:'(Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)'}},
      en:{navHome:'Home',navMenu:'Menu',navKaraoke:'Karaoke',navContact:'Contact',
          ui:{add:'Add',more:'More',itemsShort:'pcs',viewList:'List view',viewGrid:'Grid view'},
          sheet:{title:'Your order',empty:'Cart is empty.',orderType:'Order type',
                 onSite:'Dine-in',takeaway:'Takeaway',delivery:'Delivery',
                 table:'Table',pickupIn:'Pickup in (min)',address:'Delivery address',phone:'Phone',
                 phTable:'e.g., 5',phPickup:'15',phAddress:'City, street, houseâ€¦',phPhone:'+48 600 000 000',
                 total:'Total',checkout:'Checkout',clear:'Clear cart',
                 errTable:'Please enter table number.',errPickup:'Please enter pickup time (min).',
                 errPhone:'Please enter phone.',errAddress:'Please enter delivery address.'},
          common:{required:'(required)',optional:'(optional)'}},
      ua:{navHome:'Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°',navMenu:'ĞœĞµĞ½Ñ',navKaraoke:'ĞšĞ°Ñ€Ğ°Ğ¾ĞºĞµ',navContact:'ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¸',
          ui:{add:'Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸',more:'Ğ”Ğ¾ĞºĞ»Ğ°Ğ´Ğ½Ñ–ÑˆĞµ',itemsShort:'ÑˆÑ‚.',viewList:'Ğ’Ğ¸Ğ³Ğ»ÑĞ´ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼',viewGrid:'Ğ’Ğ¸Ğ³Ğ»ÑĞ´ ÑÑ–Ñ‚ĞºĞ¾Ñ'},
          sheet:{title:'Ğ’Ğ°ÑˆĞµ Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ',empty:'ĞšĞ¾ÑˆĞ¸Ğº Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ–Ğ¹.',orderType:'Ğ¢Ğ¸Ğ¿ Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ',
                 onSite:'Ğ£ Ğ·Ğ°ĞºĞ»Ğ°Ğ´Ñ–',takeaway:'ĞĞ° Ğ²Ğ¸Ğ½Ñ–Ñ',delivery:'Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°',
                 table:'Ğ¡Ñ‚Ñ–Ğ»',pickupIn:'Ğ§ĞµÑ€ĞµĞ· ÑĞºÑ–Ğ»ÑŒĞºĞ¸ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚Ğ¸ (Ñ…Ğ²)',address:'ĞĞ´Ñ€ĞµÑĞ° Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸',phone:'Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½',
                 phTable:'ĞĞ°Ğ¿Ñ€Ğ¸ĞºĞ»Ğ°Ğ´, 5',phPickup:'15',phAddress:'ĞœÑ–ÑÑ‚Ğ¾, Ğ²ÑƒĞ»Ğ¸Ñ†Ñ, Ğ±ÑƒĞ´Ğ¸Ğ½Ğ¾Ğºâ€¦',phPhone:'+48 600 000 000',
                 total:'Ğ Ğ°Ğ·Ğ¾Ğ¼',checkout:'ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚Ğ¸',clear:'ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸ ĞºĞ¾ÑˆĞ¸Ğº',
                 errTable:'Ğ’ĞºĞ°Ğ¶Ñ–Ñ‚ÑŒ Ğ½Ğ¾Ğ¼ĞµÑ€ ÑÑ‚Ğ¾Ğ»Ñƒ.',errPickup:'Ğ’ĞºĞ°Ğ¶Ñ–Ñ‚ÑŒ Ñ‡Ğ°Ñ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ (Ñ…Ğ²).',
                 errPhone:'Ğ’ĞºĞ°Ğ¶Ñ–Ñ‚ÑŒ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½.',errAddress:'Ğ’ĞºĞ°Ğ¶Ñ–Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑÑƒ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸.'},
          common:{required:'(Ğ¾Ğ±Ğ¾Ğ²â€™ÑĞ·ĞºĞ¾Ğ²Ğ¾)',optional:'(Ğ½ĞµĞ¾Ğ±Ğ¾Ğ²â€™ÑĞ·ĞºĞ¾Ğ²Ğ¾)'}},
      pl:{navHome:'Start',navMenu:'Menu',navKaraoke:'Karaoke',navContact:'Kontakt',
          ui:{add:'Dodaj',more:'SzczegÃ³Å‚y',itemsShort:'szt.',viewList:'Widok listy',viewGrid:'Widok siatki'},
          sheet:{title:'Twoje zamÃ³wienie',empty:'Koszyk jest pusty.',orderType:'Rodzaj zamÃ³wienia',
                 onSite:'Na miejscu',takeaway:'Na wynos',delivery:'Dostawa',
                 table:'StÃ³Å‚',pickupIn:'OdbiÃ³r za (min)',address:'Adres dostawy',phone:'Telefon',
                 phTable:'Np. 5',phPickup:'15',phAddress:'Miasto, ulica, nr domuâ€¦',phPhone:'+48 600 000 000',
                 total:'Suma',checkout:'ZamÃ³w',clear:'WyczyÅ›Ä‡ koszyk',
                 errTable:'Podaj numer stoÅ‚u.',errPickup:'Podaj czas odbioru (min).',
                 errPhone:'Podaj telefon.',errAddress:'Podaj Ğ°Ğ´Ñ€ĞµÑ dostawy.'},
          common:{required:'(wymagane)',optional:'(opcjonalnie)'}},
      de:{navHome:'Start',navMenu:'MenÃ¼',navKaraoke:'Karaoke',navContact:'Kontakt',
          ui:{add:'HinzufÃ¼gen',more:'Details',itemsShort:'St.',viewList:'Listenansicht',viewGrid:'Rasteransicht'},
          sheet:{title:'Ihre Bestellung',empty:'Warenkorb ist leer.',orderType:'Bestellart',
                 onSite:'Vor Ort',takeaway:'Zum Mitnehmen',delivery:'Lieferung',
                 table:'Tisch',pickupIn:'Abholung in (Min.)',address:'Lieferadresse',phone:'Telefon',
                 phTable:'z. B. 5',phPickup:'15',phAddress:'Stadt, StraÃŸe, Nr.â€¦',phPhone:'+48 600 000 000',
                 total:'Gesamt',checkout:'Bestellen',clear:'Warenkorb leeren',
                 errTable:'Bitte Tisch-Nr. eingeben.',errPickup:'Bitte Abholzeit (Min.) eingeben.',
                 errPhone:'Bitte Telefon eingeben.',errAddress:'Bitte Lieferadresse eingeben.'},
          common:{required:'(erforderlich)',optional:'(optional)'}},
      zh:{navHome:'ä¸»é¡µ',navMenu:'èœå•',navKaraoke:'å¡æ‹‰OK',navContact:'è”ç³»',
          ui:{add:'æ·»åŠ ',more:'è¯¦æƒ…',itemsShort:'ä»¶',viewList:'åˆ—è¡¨è§†å›¾',viewGrid:'ç½‘æ ¼è§†å›¾'},
          sheet:{title:'æ‚¨çš„è®¢å•',empty:'è´­ç‰©è½¦ä¸ºç©ºã€‚',orderType:'è®¢å•ç±»å‹',
                 onSite:'å ‚é£Ÿ',takeaway:'å¤–å¸¦',delivery:'é…é€',
                 table:'æ¡Œå·',pickupIn:'å–é¤æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰',address:'é…é€åœ°å€',phone:'ç”µè¯',
                 phTable:'ä¾‹å¦‚ 5',phPickup:'15',phAddress:'åŸå¸‚ã€è¡—é“ã€é—¨ç‰Œâ€¦',phPhone:'+48 600 000 000',
                 total:'åˆè®¡',checkout:'ä¸‹å•',clear:'æ¸…ç©ºè´­ç‰©è½¦',
                 errTable:'è¯·è¾“å…¥æ¡Œå·ã€‚',errPickup:'è¯·è¾“å…¥å–é¤æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ã€‚',
                 errPhone:'è¯·è¾“å…¥ç”µè¯ã€‚',errAddress:'è¯·è¾“å…¥é…é€åœ°å€ã€‚'},
          common:{required:'(å¿…å¡«)',optional:'(å¯é€‰)'}},
      vn:{navHome:' Trang chá»§',navMenu:'Thá»±c Ä‘Æ¡n',navKaraoke:'Karaoke',navContact:'LiÃªn há»‡',
          ui:{add:'ThÃªm',more:'Chi tiáº¿t',itemsShort:'mÃ³n',viewList:'Dáº¡ng danh sÃ¡ch',viewGrid:'Dáº¡ng lÆ°á»›i'},
          sheet:{title:'ÄÆ¡n hÃ ng cá»§a báº¡n',empty:'Giá» hÃ ng trá»‘ng.',orderType:'HÃ¬nh thá»©c Ä‘áº·t',
                 onSite:'Ä‚n táº¡i chá»—',takeaway:'Mang Ä‘i',delivery:'Giao hÃ ng',
                 table:'BÃ n',pickupIn:'Nháº­n sau (phÃºt)',address:'Äá»‹a chá»‰ giao hÃ ng',phone:'Äiá»‡n thoáº¡i',
                 phTable:'VÃ­ dá»¥: 5',phPickup:'15',phAddress:'ThÃ nh phá»‘, Ä‘Æ°á»ng, sá»‘ nhÃ â€¦',phPhone:'+48 600 000 000',
                 total:'Tá»•ng cá»™ng',checkout:'Äáº·t hÃ ng',clear:'XÃ³a giá» hÃ ng',
                 errTable:'Vui lÃ²ng nháº­p sá»‘ bÃ n.',errPickup:'Vui lÃ²ng nháº­p thá»i gian nháº­n (phÃºt).',
                 errPhone:'Vui lÃ²ng nháº­p sá»‘ Ä‘iá»‡n thoáº¡i.',errAddress:'Vui lÃ²ng nháº­p Ä‘á»‹a chá»‰ giao hÃ ng.'},
          common:{required:'(báº¯t buá»™c)',optional:'(khÃ´ng báº¯t buá»™c)'}}
    };
    const L = ()=>I18N[LANG]||I18N.en;

    /* Descriptions lazy-load */
    let DESCS = null;
    async function loadDescriptions(){
      if(DESCS) return DESCS;
      try{
        const resp = await fetch('descriptions.json');
        if(resp.ok){ DESCS = await resp.json(); return DESCS; }
      }catch(e){ console.error('Failed to load descriptions.json', e); }
      DESCS = {}; return DESCS;
    }

    /* Category labels */
    const CAT_LABELS = {
      'featured':                {ru:'Ğ’Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ğµ', en:'Featured', ua:'Ğ’Ğ¸Ğ´Ñ–Ğ»ĞµĞ½Ñ–',     pl:'WyrÃ³Å¼nione',           de:'Hervorgehoben',            zh:'ç²¾é€‰',         vn:'Ná»•i báº­t'},
      'soups':                   {ru:'Ğ¡ÑƒĞ¿Ñ‹',       en:'Soups',    ua:'Ğ¡ÑƒĞ¿Ğ¸',         pl:'Zupy',                 de:'Suppen',                   zh:'æ±¤å“',         vn:'SÃºp'},
      'appetizers':              {ru:'Ğ—Ğ°ĞºÑƒÑĞºĞ¸',    en:'Appetizers',ua:'Ğ—Ğ°ĞºÑƒÑĞºĞ¸',     pl:'PrzekÄ…ski',            de:'Vorspeisen',               zh:'å¼€èƒƒèœ',        vn:'MÃ³n khai vá»‹'},

      'chicken_dishes':          {ru:'Ğ‘Ğ»ÑĞ´Ğ° Ñ ĞºÑƒÑ€Ğ¸Ñ†ĞµĞ¹',     en:'Chicken Dishes',     ua:'Ğ¡Ñ‚Ñ€Ğ°Ğ²Ğ¸ Ğ· ĞºÑƒÑ€ĞºĞ¸',      pl:'Dania z kurczakiem',       de:'Gerichte mit Huhn',         zh:'é¸¡è‚‰èœè‚´',      vn:'MÃ³n gÃ '},
      'pork_dishes':             {ru:'Ğ‘Ğ»ÑĞ´Ğ° ÑĞ¾ ÑĞ²Ğ¸Ğ½Ğ¸Ğ½Ğ¾Ğ¹',   en:'Pork Dishes',        ua:'Ğ¡Ñ‚Ñ€Ğ°Ğ²Ğ¸ Ğ·Ñ– ÑĞ²Ğ¸Ğ½Ğ¸Ğ½Ğ¸',   pl:'Dania z wieprzowinÄ…',      de:'Gerichte mit Schweinefleisch', zh:'çŒªè‚‰èœè‚´',   vn:'MÃ³n heo'},
      'beef_dishes':             {ru:'Ğ‘Ğ»ÑĞ´Ğ° Ñ Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ¾Ğ¹',   en:'Beef Dishes',        ua:'Ğ¡Ñ‚Ñ€Ğ°Ğ²Ğ¸ Ğ· ÑĞ»Ğ¾Ğ²Ğ¸Ñ‡Ğ¸Ğ½Ğ¸',  pl:'Dania z woÅ‚owinÄ…',         de:'Gerichte mit Rindfleisch',  zh:'ç‰›è‚‰èœè‚´',      vn:'MÃ³n bÃ²'},

      'fried_chinese_noodles':   {ru:'Ğ–Ğ°Ñ€ĞµĞ½Ğ°Ñ ĞºĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ°Ñ Ğ»Ğ°Ğ¿ÑˆĞ°', en:'Fried Chinese Noodles', ua:'Ğ¡Ğ¼Ğ°Ğ¶ĞµĞ½Ğ° ĞºĞ¸Ñ‚Ğ°Ğ¹ÑÑŒĞºĞ° Ğ»Ğ¾ĞºÑˆĞ¸Ğ½Ğ°', pl:'Makaron chiÅ„ski smaÅ¼ony', de:'Gebratene chinesische Nudeln', zh:'ç‚’ä¸­å¼é¢æ¡', vn:'MÃ¬ Trung Quá»‘c xÃ o'},
      'fried_soy_noodles':       {ru:'Ğ–Ğ°Ñ€ĞµĞ½Ğ°Ñ ÑĞ¾ĞµĞ²Ğ°Ñ Ğ»Ğ°Ğ¿ÑˆĞ°',    en:'Fried Soy Noodles',     ua:'Ğ¡Ğ¼Ğ°Ğ¶ĞµĞ½Ğ° ÑĞ¾Ñ”Ğ²Ğ° Ğ»Ğ¾ĞºÑˆĞ¸Ğ½Ğ°',     pl:'Makaron sojowy smaÅ¼ony',   de:'Gebratene Sojanudeln',       zh:'ç‚’è±†é¢æ¡',     vn:'MÃ¬ Ä‘áº­u nÃ nh xÃ o'},
      'udon_noodles':            {ru:'Ğ›Ğ°Ğ¿ÑˆĞ° ÑƒĞ´Ğ¾Ğ½',              en:'Udon Noodles',          ua:'Ğ›Ğ¾ĞºÑˆĞ¸Ğ½Ğ° ÑƒĞ´Ğ¾Ğ½',              pl:'Makaron udon',              de:'Udon-Nudeln',                 zh:'ä¹Œå†¬é¢',        vn:'MÃ¬ udon'},
      'pad_thai':                {ru:'ĞŸĞ°Ğ´ Ğ¢Ğ°Ğ¹',                 en:'Pad Thai',              ua:'ĞŸĞ°Ğ´ Ğ¢Ğ°Ğ¹',                    pl:'Pad Thai',                   de:'Pad Thai',                     zh:'æ³°å¼ç‚’æ²³ç²‰',    vn:'Pad Thai'},
      'fried_rice':              {ru:'Ğ–Ğ°Ñ€ĞµĞ½Ñ‹Ğ¹ Ñ€Ğ¸Ñ',             en:'Fried Rice',            ua:'Ğ¡Ğ¼Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ€Ğ¸Ñ',               pl:'RyÅ¼ smaÅ¼ony',               de:'Gebratener Reis',             zh:'ç‚’é¥­',          vn:'CÆ¡m chiÃªn'},

      'duck_dishes':             {ru:'Ğ‘Ğ»ÑĞ´Ğ° Ñ ÑƒÑ‚ĞºĞ¾Ğ¹',           en:'Duck Dishes',           ua:'Ğ¡Ñ‚Ñ€Ğ°Ğ²Ğ¸ Ğ· ĞºĞ°Ñ‡ĞºĞ¸',            pl:'Dania z kaczkÄ…',            de:'Gerichte mit Ente',           zh:'é¸­è‚‰èœè‚´',      vn:'MÃ³n vá»‹t'},
      'fish_seafood':            {ru:'Ğ‘Ğ»ÑĞ´Ğ° Ñ Ñ€Ñ‹Ğ±Ğ¾Ğ¹ Ğ¸ Ğ¼Ğ¾Ñ€ĞµĞ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°Ğ¼Ğ¸', en:'Fish & Seafood Dishes', ua:'Ğ¡Ñ‚Ñ€Ğ°Ğ²Ğ¸ Ğ· Ñ€Ğ¸Ğ±Ğ¸ Ñ‚Ğ° Ğ¼Ğ¾Ñ€ĞµĞ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ–Ğ²', pl:'Dania z rybÄ… i owocami morza', de:'Gerichte mit Fisch und MeeresfrÃ¼chten', zh:'é±¼å’Œæµ·é²œèœè‚´', vn:'MÃ³n cÃ¡ vÃ  háº£i sáº£n'},
      'knuckle_dishes':          {ru:'Ğ‘Ğ»ÑĞ´Ğ° Ñ Ğ³Ğ¾Ğ»ÑÑˆĞºĞ¾Ğ¹',        en:'Knuckle Dishes',        ua:'Ğ¡Ñ‚Ñ€Ğ°Ğ²Ğ¸ Ğ· Ğ³Ğ¾Ğ»ÑÑˆĞºĞ¸',          pl:'Dania z golonkÄ…',           de:'Gerichte mit Haxe',           zh:'çŒªè¹„èœè‚´',      vn:'MÃ³n giÃ² heo'},

      'curry':                   {ru:'ĞšĞ°Ñ€Ñ€Ğ¸',                   en:'Curry',                 ua:'ĞšĞ°Ñ€Ñ€Ñ–',                      pl:'Curry',                     de:'Curry',                        zh:'å’–å–±',          vn:'CÃ  ri'},
      'hot_plate_dishes':        {ru:'Ğ‘Ğ»ÑĞ´Ğ° Ñ Ğ³Ğ¾Ñ€ÑÑ‡ĞµĞ¹ Ñ‚Ğ°Ñ€ĞµĞ»ĞºĞ¸', en:'Hot Plate Dishes',      ua:'Ğ¡Ñ‚Ñ€Ğ°Ğ²Ğ¸ Ğ· Ğ³Ğ°Ñ€ÑÑ‡Ğ¾Ñ— Ñ‚Ğ°Ñ€Ñ–Ğ»ĞºĞ¸',  pl:'Dania z gorÄ…cego pÃ³Å‚miska', de:'Gerichte vom heiÃŸen Teller',  zh:'çƒ­ç›˜èœè‚´',       vn:'MÃ³n Ä‘Ä©a nÃ³ng'},
      'vegetarian_dishes':       {ru:'Ğ’ĞµĞ³ĞµÑ‚Ğ°Ñ€Ğ¸Ğ°Ğ½ÑĞºĞ¸Ğµ Ğ±Ğ»ÑĞ´Ğ°',    en:'Vegetarian Dishes',     ua:'Ğ’ĞµĞ³ĞµÑ‚Ğ°Ñ€Ñ–Ğ°Ğ½ÑÑŒĞºÑ– ÑÑ‚Ñ€Ğ°Ğ²Ğ¸',     pl:'Dania wegetariaÅ„skie',      de:'Vegetarische Gerichte',       zh:'ç´ é£Ÿèœè‚´',      vn:'MÃ³n chay'},

      'sides':                   {ru:'Ğ”Ğ¾Ğ±Ğ°Ğ²ĞºĞ¸',                 en:'Sides',                 ua:'Ğ”Ğ¾Ğ±Ğ°Ğ²ĞºĞ¸',                    pl:'Dodatki',                   de:'Beilagen',                     zh:'é…èœ',          vn:'Phá»¥ kiá»‡n'},
      'drinks':                  {ru:'ĞĞ°Ğ¿Ğ¸Ñ‚ĞºĞ¸',                 en:'Drinks',                ua:'ĞĞ°Ğ¿Ğ¾Ñ—',                      pl:'Napoje',                    de:'GetrÃ¤nke',                     zh:'é¥®æ–™',          vn:'Äá»“ uá»‘ng'}
    };
    const catLabel = k => (CAT_LABELS[k]?.[LANG] || CAT_LABELS[k]?.en || k);

    /* Helpers & state */
    const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
    const CURRENCY='zÅ‚';
    const IMG_DIR='images/'; const IMG_EXTS=['webp','jpg','jpeg','png'];
    const fmt=n=>Number(n).toFixed(2)+' '+CURRENCY;

    function buildThumb(imgEl,key){
      let i=0; const trySet=()=>imgEl.src=IMG_DIR+key+'.'+IMG_EXTS[i];
      imgEl.onerror=()=>{ i++; if(i<IMG_EXTS.length){ trySet(); } else { imgEl.closest('.thumb')?.classList.add('noimg'); imgEl.remove(); } };
      trySet();
    }
    const itemName=it=>it?.translations?.[LANG]||it?.translations?.en||it?.key?.replaceAll('_',' ')||'';

    const cart=new Map();

    /* Pills */
    function renderPills(){
      const keys=Object.keys(menuData||{}); 
      $('#catPills').innerHTML=keys.map((k,i)=>`<a class="pill ${i===0?'active':''}" href="#sec-${k}">${catLabel(k)}</a>`).join('');
    }

    /* View toggle â€” ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ (Ñ‡ĞµÑ€ĞµĞ· Ğ½Ğ¸Ğ¶Ğ½Ğ¸Ğ¹ Ğ´Ğ¾Ğº) */
    const VIEW_KEY='CD_VIEW_MENU';
    let viewMode = localStorage.getItem(VIEW_KEY) || 'grid';
    function applyView(){
      $$('.list').forEach(wrap => wrap.classList.toggle('as-list', viewMode==='list'));
    }

    /* Meta info builder for each dish */
    function buildMeta(it){
      if(!it) return '';
      const parts = [];

      if(it.weight){
        parts.push(it.weight + ' g');
      }
      if(it.kcal){
        parts.push(it.kcal + ' kcal');
      }
      if(it.spicy){
        const level = Math.max(1, Math.min(3, Number(it.spicy)));
        parts.push('ğŸŒ¶'.repeat(level));
      }
      if(Array.isArray(it.tags) && it.tags.length){
        const mapped = it.tags.map(t=>{
          switch(t){
            case 'vegan':     return 'ğŸŒ± vegan';
            case 'veg':       return 'ğŸ¥¦ veg';
            case 'no_gluten': return 'ğŸš« gluten';
            case 'chef':      return 'â­ chef';
            case 'popular':   return 'ğŸ”¥ top';
            default:          return t;
          }
        });
        parts.push(mapped.join(' Â· '));
      }
      if(!parts.length) return '';
      return `<div class="meta">${parts.join(' â€¢ ')}</div>`;
    }

    /* Render menu */
    function renderMenu(){
      const content = $('#content'); 
      const keys=Object.keys(menuData||{});
      content.innerHTML = '';
      keys.forEach(k => {
        const sec = document.createElement('section');
        sec.id = `sec-${k}`;
        const h2 = document.createElement('h2');
        h2.textContent = catLabel(k);
        sec.appendChild(h2);
        const list = document.createElement('div');
        list.className = 'list';
        const items=(menuData[k]||[]); const t=L();
        list.innerHTML=items.map((it,idx)=>{
          const id = `${k}:${idx}`, name = itemName(it), price = fmt(it.price||0);
          const qty = cart.get(id) || 0;
          const btn = qty
            ? `<div class="qty" data-qty="${id}"><button data-dec="${id}">âˆ’</button><span>${qty}</span><button data-inc="${id}">+</button></div>`
            : `<button class="add" data-add="${id}">${t.ui.add}</button>`;
          const more = t.ui.more;
          const key = (it && (it.key || it.id || it.code)) || '';
          const shortDesc = (it && (it.short || it.desc || '')) || '';
          const metaHtml = buildMeta(it);
          return `
            <div class="card" data-id="${id}"${key ? ` data-key="${key}"` : ''}>
              <div class="thumb-wrap">
                <div class="thumb"><img alt="${name}" loading="lazy" decoding="async"></div>
                <button class="info" data-toggle="${id}" title="${more}" aria-label="${more}" aria-expanded="false" aria-controls="desc-${id}">i</button>
              </div>
              <div class="name">${name}</div>
              ${metaHtml}
              <p class="desc" id="desc-${id}" aria-hidden="true">${shortDesc}</p>
              <div class="foot">
                <div class="price">${price}</div>
                ${btn}
              </div>
            </div>`;
        }).join('');
        sec.appendChild(list);
        content.appendChild(sec);

        // images
        list.querySelectorAll('.card').forEach(row=>{
          const id=row.getAttribute('data-id'); const [cat,idx]=id.split(':');
          const key=(menuData?.[cat]?.[+idx]?.key)||''; const img=row.querySelector('.thumb img');
          if(img && key) buildThumb(img,key);
        });
      });
      applyView();
    }

    /* Cart renders */
    function renderFab(){
      const t=L().ui; let items=0,sum=0;
      for(const [id,qty] of cart){
        const [cat,idx]=id.split(':');
        const it=menuData[cat]?.[+idx]; if(!it) continue;
        items+=qty; sum+=(it.price||0)*qty;
      }
      $('#fabText').textContent=`${items} ${t.itemsShort} â€¢ ${fmt(sum)}`;
    }
    function renderCartSheet(){
      const t=L().sheet; const lines=$('#cartLines');
      if(cart.size===0){
        lines.innerHTML=`<div class="muted">${t.empty}</div>`;
        $('#cartMeta').textContent=`${t.total}: ${fmt(0)}`;
        return;
      }
      let sum=0;
      lines.innerHTML='';
      for(const [id,qty] of cart){
        const [cat,idx]=id.split(':'); const it=menuData[cat]?.[+idx]; if(!it) continue;
        const name=itemName(it); const price=Number(it.price||0); sum+=price*qty;
        const el=document.createElement('div'); el.className='line';
        el.innerHTML=`<div><strong>${name}</strong><div class="muted">${fmt(price)} Ã— ${qty}</div></div>
          <div class="qty" data-qty="${id}"><button data-dec="${id}">âˆ’</button><span>${qty}</span><button data-inc="${id}">+</button></div>`;
        lines.appendChild(el);
      }
      $('#cartMeta').textContent=`${t.total}: ${fmt(sum)}`;
    }

    function openSheet(){
      document.body.style.overflow='hidden';
      $('#overlay').classList.add('show');
      $('#sheet').classList.add('open');
      renderCartSheet();
    }
    function closeSheet(){
      document.body.style.overflow='';
      $('#overlay').classList.remove('show');
      $('#sheet').classList.remove('open');
    }

    /* Events */
    document.addEventListener('click', async e=>{
      const add=e.target.closest('[data-add]');
      if(add){
        const id=add.dataset.add;
        cart.set(id,(cart.get(id)||0)+1);
        renderMenu(); renderFab();
        return;
      }
      const inc=e.target.closest('[data-inc]');
      if(inc){
        const id=inc.dataset.inc;
        cart.set(id,(cart.get(id)||0)+1);
        renderMenu(); renderCartSheet(); renderFab();
        return;
      }
      const dec=e.target.closest('[data-dec]');
      if(dec){
        const id=dec.dataset.dec;
        const q=(cart.get(id)||0)-1;
        if(q<=0) cart.delete(id); else cart.set(id,q);
        renderMenu(); renderCartSheet(); renderFab();
        return;
      }
      const info=e.target.closest('[data-toggle]');
      if(info){
        e.preventDefault();
        const cardId = info.dataset.toggle;
        const card   = document.querySelector(`.card[data-id="${cardId}"]`);
        if(card){
          const expanded = card.classList.contains('expanded');
          if(!expanded){
            const descEl = card.querySelector('.desc');
            if(descEl){
              let text = '';
              let key = card.getAttribute('data-key');
              if(!key){
                const parts0 = cardId.split(':');
                if(parts0.length === 2){
                  const [cat0, idx0] = parts0;
                  const it0 = (menuData?.[cat0] || [])[+idx0];
                  key = (it0 && (it0.key || it0.id || it0.code)) || '';
                }
              }
              if(key){
                try{
                  const descs = await loadDescriptions();
                  const entry = descs[key];
                  if(entry && entry.description){
                    text = entry.description[LANG] || entry.description.en || '';
                  }
                }catch(err){ console.error(err); }
              }
              if(!text){
                const parts1 = cardId.split(':');
                if(parts1.length === 2){
                  const [cat1, idx1] = parts1;
                  const it1 = (menuData?.[cat1] || [])[+idx1];
                  const fallback = (it1 && (it1.desc || it1.short || '')) || '';
                  text = fallback;
                }
              }
              if(text) descEl.textContent = text;
            }
          }
          card.classList.toggle('expanded');
          info.setAttribute('aria-expanded', (!expanded).toString());
          const descEl2 = card.querySelector('.desc');
          if(descEl2) descEl2.setAttribute('aria-hidden', expanded.toString());
        }
        return;
      }
      if(e.target.closest('#cartFab')){ openSheet(); return; }
      if(e.target.id==='overlay'){ closeSheet(); return; }
      if(e.target.id==='clearBtn'){
        cart.clear(); renderMenu(); renderCartSheet(); renderFab();
        return;
      }
    });

    /* Burger */
    const burgerBtn=$('#burgerBtn'), navPop=$('#navPop');
    burgerBtn.addEventListener('click',()=>{const open=navPop.classList.toggle('open'); burgerBtn.setAttribute('aria-expanded',String(open));});
    document.addEventListener('click',e=>{if(!navPop.contains(e.target)&&e.target!==burgerBtn){navPop.classList.remove('open'); burgerBtn.setAttribute('aria-expanded','false');}});

    /* Order type switch */
    const otWrap=$('#orderType'), tableField=$('#tableField'), takeawayField=$('#takeawayField'), addrField=$('#addrField');
    const tableNo=$('#tableNo'), pickupIn=$('#pickupIn'), address=$('#address'), phone=$('#phone');
    const phoneHint=$('#phoneHint'), tableHint=$('#tableHint'), pickupHint=$('#pickupHint'), addrHint=$('#addrHint');

    function show(el,on){ el.style.display=on?'grid':'none'; }
    function setOrderType(v){
      const c=L();
      show(tableField, v==='on_site');
      show(takeawayField, v==='takeaway');
      show(addrField, v==='delivery');
      tableNo.required=(v==='on_site');
      pickupIn.required=(v==='takeaway');
      address.required=(v==='delivery');
      phoneHint.textContent = (v==='on_site') ? c.common.optional : c.common.required;
      tableHint.textContent  = c.common.required;
      pickupHint.textContent = c.common.required;
      addrHint.textContent   = c.common.required;
    }
    otWrap.addEventListener('click',e=>{
      const b=e.target.closest('[data-ot]'); if(!b) return;
      $$('#orderType .chip').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      setOrderType(b.dataset.ot);
    });

    /* I18N apply */
    const selA = $('#langSel'), selB = $('#langSelMenu'), selDock = $('#langSelDock');
    function setUITexts(){
      const t=L(), s=t.sheet;

      $('#navHome').textContent  = 'ğŸ  ' + t.navHome;
      $('#navMenu').textContent  = 'ğŸœ ' + t.navMenu;
      $('#navKaraoke').textContent='ğŸ¤ ' + t.navKaraoke;
      $('#navContact').textContent='ğŸ“ ' + t.navContact;

      $('#sheetTitle').textContent     = s.title;
      $('#orderTypeTitle').textContent = s.orderType;
      $('#otOnSite').textContent       = s.onSite;
      $('#otTakeaway').textContent     = s.takeaway;
      $('#otDelivery').textContent     = s.delivery;

      $('#tableLbl').childNodes[0].nodeValue  = s.table + ' ';
      $('#pickupLbl').childNodes[0].nodeValue = s.pickupIn + ' ';
      $('#addrLbl').childNodes[0].nodeValue   = s.address + ' ';
      $('#phoneLbl').childNodes[0].nodeValue  = s.phone + ' ';

      tableNo.placeholder  = s.phTable;
      pickupIn.placeholder = s.phPickup;
      address.placeholder  = s.phAddress;
      phone.placeholder    = s.phPhone;

      const meta=$('#cartMeta');
      if(meta){
        const sum=(meta.textContent.match(/[\d.,]+\s*zÅ‚/)||['0.00 zÅ‚'])[0];
        meta.textContent=`${s.total}: ${sum}`;
      }
      $('#checkoutBtn').textContent = s.checkout;
      $('#clearBtn').textContent    = s.clear;

      const csTitle = document.getElementById('catSheetTitle');
      if (csTitle) csTitle.textContent = t.navMenu || 'ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸';

      renderPills(); renderMenu(); renderFab(); renderCartSheet();

      const active=document.querySelector('#orderType .chip.active')?.dataset.ot||'on_site';
      setOrderType(active);
    }
    function setLang(v){
      LANG = v;
      localStorage.setItem(LANG_KEY, v);
      document.documentElement.lang = v;

      if (selA) selA.value = v;
      if (selB) selB.value = v;
      if (selDock) selDock.value = v;

      setUITexts();
      document.dispatchEvent(new CustomEvent('CD_LANG_CHANGED'));
    }

    selA?.addEventListener('change', e => setLang(e.target.value));
    selB?.addEventListener('change', e => setLang(e.target.value));
    selDock?.addEventListener('change', e => setLang(e.target.value));

    /* Telegram (use proxy; do NOT expose tokens on client) */
    const TG = {
      BOT_TOKEN:"",
      CHAT_ID:"",
      PROXY_URL:"/api/tg/sendMessage"
    }; // <-- Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ
    const TG_ENDPOINT = (b)=> (TG.PROXY_URL || `https://api.telegram.org/bot${b}/sendMessage`);
    async function sendOrderToTelegram(text){
      const url = TG_ENDPOINT(TG.BOT_TOKEN);
      const payload = {
        chat_id: TG.CHAT_ID,
        text,
        parse_mode: "HTML",
        disable_web_page_preview: true
      };
      try{
        const r = await fetch(url,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify(payload)
        });
        if(r.ok) return {ok:true};
        await fetch(url,{
          method:'POST',
          mode:'no-cors',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify(payload)
        });
        return {ok:true, opaque:true};
      }catch(e){
        console.error(e);
        return {ok:false, reason:String(e)};
      }
    }

    // ==== Google Sheets: create order ====
    async function createOrderOnSheet(orderPayload){
      const body = {
        action: 'create',
        ...orderPayload
      };
      try{
        const res = await fetch(API_BASE,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify(body)
        });
        const data = await res.json();
        return data;
      }catch(e){
        console.error('Sheets error', e);
        return {ok:false, error:String(e)};
      }
    }

    // Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹ Ğ´Ğ»Ñ Telegram + Sheets
    function cartSummary(){
      let itemsCount=0,sum=0, lines=[], items=[];
      for(const [id,qty] of cart){
        const [cat,idx]=id.split(':');
        const it=menuData[cat]?.[+idx]; if(!it) continue;
        const name=itemName(it);
        const price=Number(it.price||0);
        const key = it.key || it.id || it.code || '';
        itemsCount+=qty;
        sum+=price*qty;
        lines.push(`â€¢ ${name} â€” ${price.toFixed(2)} ${CURRENCY} Ã— ${qty}`);
        items.push({
          name,
          price,
          qty,
          key
        });
      }
      return {itemsCount,sum,lines,items};
    }

    // Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ° Ğ·Ğ°ĞºĞ°Ğ·Ğ°: a001â€“z999
    function generateShortCode(){
      const letters = 'abcdefghijklmnopqrstuvwxyz';
      const letter = letters[Math.floor(Math.random()*letters.length)];
      const num = Math.floor(Math.random()*999)+1;
      return letter + String(num).padStart(3,'0');
    }

    $('#checkoutBtn').addEventListener('click', async ()=>{
      const s=L().sheet;
      const ot=document.querySelector('#orderType .chip.active')?.dataset.ot||'on_site';

      if(ot==='on_site' && !tableNo.value.trim()){
        alert(s.errTable); return;
      }
      if(ot==='takeaway'){
        if(!pickupIn.value.trim()){ alert(s.errPickup); return; }
        if(!phone.value.trim()){ alert(s.errPhone); return; }
      }
      if(ot==='delivery'){
        if(!address.value.trim()){ alert(s.errAddress); return; }
        if(!phone.value.trim()){ alert(s.errPhone); return; }
      }

      const {sum,lines,items} = cartSummary();
      const typeStr = ot==='on_site'?s.onSite:ot==='takeaway'?s.takeaway:s.delivery;
      const meta=[];
      if(ot==='on_site') meta.push(`${s.table}: ${tableNo.value.trim()}`);
      if(ot==='takeaway') meta.push(`${s.pickupIn}: ${pickupIn.value.trim()}`);
      if(ot==='delivery') meta.push(`${s.address}: ${address.value.trim()}`);
      if(phone.value.trim()) meta.push(`${s.phone}: ${phone.value.trim()}`);

      const ordId='CD-'+new Date().toISOString().replace(/[-:TZ.]/g,'').slice(0,14);
      const orderCode = generateShortCode();

      const text =
`<b>CYBER DRAGON â€” New order</b>
ID: <code>${ordId}</code>
Code: <b>${orderCode}</b>
${s.total}: <b>${sum.toFixed(2)} ${CURRENCY}</b>
Type: <b>${typeStr}</b>
${meta.join('\n')}

<b>Items:</b>
${lines.join('\n') || 'â€”'}`;

      // ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° payload Ğ´Ğ»Ñ Google Sheets
      const orderPayload = {
        id: ordId,
        code: orderCode,
        status: 'NEW',           // Ğ´Ğ°Ğ»ÑŒÑˆĞµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¼ĞµĞ½ÑÑ‚ÑŒÑÑ Ñ‡ĞµÑ€ĞµĞ· admin/kitchen
        type: ot,
        table: ot==='on_site' ? tableNo.value.trim() : '',
        pickup_in: ot==='takeaway' ? pickupIn.value.trim() : '',
        address: ot==='delivery' ? address.value.trim() : '',
        phone: phone.value.trim(),
        items,
        total: sum,
        created_at: new Date().toISOString()
      };

      // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¸ Ğ² Telegram, Ğ¸ Ğ² Google Sheets
      const [tgRes, sheetRes] = await Promise.all([
        sendOrderToTelegram(text),
        createOrderOnSheet(orderPayload)
      ]);

      let icon;
      if ((tgRes?.ok) && (sheetRes?.ok || sheetRes?.id)) icon = 'âœ”âœ”';
      else if (tgRes?.ok || sheetRes?.ok || sheetRes?.id) icon = 'âœ”â€¦';
      else icon = 'â€¦';

      alert(`${icon} ID: ${ordId} â€¢ ${s.total}: ${sum.toFixed(2)} ${CURRENCY}`);

      cart.clear();
      renderMenu();
      renderCartSheet();
      renderFab();
      closeSheet();
    });

    /* Scroll highlight for pills */
    let activeCat = '';
    const debounce = (fn, delay) => {
      let timer;
      return () => {
        clearTimeout(timer);
        timer = setTimeout(fn, delay);
      }
    };
    function updateActive() {
      const header = $('.header');
      const catNav = $('.cat-nav');
      if (!header || !catNav) return;
      const stickyH = header.offsetHeight + catNav.offsetHeight;
      let maxTop = -Infinity; let closest = null;
      $$('section').forEach(sec => {
        const top = sec.getBoundingClientRect().top;
        if (top <= stickyH && top > maxTop) { maxTop = top; closest = sec; }
      });
      if (closest) {
        const cat = closest.id.replace('sec-', '');
        if (cat !== activeCat) {
          activeCat = cat;
          $$('.pill').forEach(p => p.classList.remove('active'));
          const pill = $(`.pill[href="#${closest.id}"]`);
          if (pill) {
            pill.classList.add('active');
            pill.scrollIntoView({behavior: 'smooth', inline: 'center'});
          }
        }
      }
    }
    window.addEventListener('scroll', debounce(updateActive, 50));

    /* ===== Dynamic Island & Ğ¿ĞµÑ€ĞµĞ½Ğ¾Ñ Ğ¿Ğ¸Ğ»ÑĞ»ÑŒ ===== */
    const catPillsEl     = document.getElementById('catPills');
    const catPillsParent = catPillsEl?.parentNode;
    const catPillsSibling = catPillsEl?.nextSibling;

    function islandThreshold(){ return 80; }
    let islandActive = false;
    const onScrollIsland = (() => {
      let ticking = false;
      return () => {
        if (ticking) return;
        ticking = true;
        requestAnimationFrame(() => {
          const needIsland = window.scrollY > islandThreshold();
          if (needIsland !== islandActive){
            islandActive = needIsland;
            document.body.classList.toggle('island', islandActive);
            const bar = document.querySelector('.bar');
            const catPills = document.getElementById('catPills');
            if (islandActive) {
              if (bar && catPills) bar.appendChild(catPills);
            } else {
              if (catPillsParent && catPills){
                if (catPillsSibling) catPillsParent.insertBefore(catPills, catPillsSibling);
                else catPillsParent.appendChild(catPills);
              }
            }
          }
          ticking = false;
        });
      };
    })();
    window.addEventListener('scroll', onScrollIsland, {passive:true});
    window.addEventListener('resize', onScrollIsland);
    onScrollIsland();

    /* ===== Bottom Dock ===== */
    const dockCat  = document.getElementById('dockCat');
    const dockView = document.getElementById('dockView');
    const catOverlay   = document.getElementById('catOverlay');
    const catSheet     = document.getElementById('catSheet');
    const catSheetList = document.getElementById('catSheetList');

    function buildCatSheet(){
      if (!catSheetList) return;
      const keys = Object.keys(menuData||{});
      catSheetList.innerHTML = keys.map(k => `<button class="chip" data-goto="#sec-${k}">${catLabel(k)}</button>`).join('');
    }
    function openCatSheet(){ buildCatSheet(); catOverlay.classList.add('show'); catSheet.classList.add('open'); }
    function closeCatSheet(){ catOverlay.classList.remove('show'); catSheet.classList.remove('open'); }
    catOverlay?.addEventListener('click', closeCatSheet);
    catSheet?.addEventListener('click', e=>{
      const b = e.target.closest('[data-goto]'); if (!b) return;
      const target = b.getAttribute('data-goto'); closeCatSheet();
      document.querySelector(target)?.scrollIntoView({behavior:'smooth', block:'start'});
    });
    dockCat?.addEventListener('click', openCatSheet);
    dockView?.addEventListener('click', ()=>{
      viewMode = (viewMode==='grid') ? 'list' : 'grid';
      localStorage.setItem(VIEW_KEY, viewMode);
      applyView();
    });

    const heroAllCats = document.getElementById('heroAllCats');
    heroAllCats?.addEventListener('click', openCatSheet);

    const brandEl = document.getElementById('brandTap');
    brandEl?.addEventListener('click', (e)=> {
      if (!document.body.classList.contains('island')) return;
      e.preventDefault();
      window.scrollTo({top:0, behavior:'smooth'});
    });

    const sheetClose = document.getElementById('sheetClose');
    const catSheetClose = document.getElementById('catSheetClose');
    sheetClose?.addEventListener('click', closeSheet);
    catSheetClose?.addEventListener('click', closeCatSheet);

    document.addEventListener('keydown', e=>{
      if(e.key === 'Escape'){
        if(document.getElementById('sheet')?.classList.contains('open')) closeSheet();
        if(document.getElementById('catSheet')?.classList.contains('open')) closeCatSheet();
      }
    });

    // Swipe-down Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ÑˆÑ‚Ğ¾Ñ€Ğ¾Ğº
    (function(){
      const cartSheet   = document.getElementById('sheet');
      const cartOverlay = document.getElementById('overlay');
      const catSheetEl  = document.getElementById('catSheet');
      const catOverlayEl= document.getElementById('catOverlay');

      const DRAG_START_ZONE = 40;
      const DISMISS_Y       = 120;
      const MAX_DRAG        = 280;

      function attachSwipe(sheetEl, overlayEl, closeFn){
        if(!sheetEl) return;

        let startY = 0;
        let currentY = 0;
        let dragging = false;

        function onStart(e){
          const touch = e.touches && e.touches[0];
          if(!touch) return;

          const rect = sheetEl.getBoundingClientRect();
          const offsetY = touch.clientY - rect.top;

          if(offsetY > DRAG_START_ZONE) return;

          dragging = true;
          startY = touch.clientY;
          currentY = 0;
          sheetEl.style.transition = 'transform .0s';
          if(overlayEl) overlayEl.style.transition = 'opacity .0s';
        }

        function onMove(e){
          if(!dragging) return;
          const touch = e.touches && e.touches[0];
          if(!touch) return;

          const dy = touch.clientY - startY;
          if(dy <= 0) {
            currentY = 0;
            sheetEl.style.transform = 'translateY(0)';
            if(overlayEl) overlayEl.style.opacity = '1';
            return;
          }

          currentY = Math.min(dy, MAX_DRAG);
          const progress = currentY / MAX_DRAG;
          sheetEl.style.transform = `translateY(${currentY}px)`;
          if(overlayEl) overlayEl.style.opacity = String(1 - progress * 0.7);
        }

        function onEnd(){
          if(!dragging) return;
          dragging = false;

          sheetEl.style.transition = 'transform .22s ease';
          if(overlayEl) overlayEl.style.transition = 'opacity .22s ease';

          if(currentY > DISMISS_Y){
            sheetEl.style.transform = `translateY(${MAX_DRAG}px)`;
            if(overlayEl) overlayEl.style.opacity = '0';
            setTimeout(()=>{
              sheetEl.style.transform = '';
              if(overlayEl) overlayEl.style.opacity = '';
              closeFn();
            }, 200);
          } else {
            sheetEl.style.transform = 'translateY(0)';
            if(overlayEl) overlayEl.style.opacity = '1';
          }
        }

        sheetEl.addEventListener('touchstart', onStart, {passive:true});
        sheetEl.addEventListener('touchmove',  onMove,  {passive:true});
        sheetEl.addEventListener('touchend',   onEnd);
        sheetEl.addEventListener('touchcancel',onEnd);
      }

      attachSwipe(cartSheet, cartOverlay, closeSheet);
      attachSwipe(catSheetEl,  catOverlayEl,  closeCatSheet);
    })();

    /* Init */
    (function init(){
      if(selA) selA.value=LANG; if(selB) selB.value=LANG;
      setUITexts();
      const header = $('.header'); const catNav = $('.cat-nav');
      if (header && catNav) { catNav.style.top = `${header.offsetHeight}px`; }
      updateActive();
      applyView();
      if (selDock) selDock.value = LANG;
    })();
    </script>
  </div>
</body>
</html>
